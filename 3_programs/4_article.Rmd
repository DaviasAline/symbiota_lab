---
title: "Analyses 12/09/2023"
author: "Aline"
date: "2023-09-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```


Chargement des données et des fonctions
```{r message=FALSE, warning=FALSE, include=FALSE}
source("~/5. R projects/symbiota_lab/3_programs/0_source_data_reading_cleaning.R", echo=TRUE)
source("~/5. R projects/symbiota_lab/3_programs/1_functions.R", echo=TRUE)
library(patchwork)
library(writexl)
library(openxlsx)
library(lavaan)
library(corrplot)
library(grDevices)
bdd_filtered <- bdd %>% filter(!is.na(BAYLEYQ4_3_12) & !is.na(sIgA_3m))
```


# Choix des variables 
```{r}
choix_covar <- bdd %>% filter(!is.na(BAYLEYQ4_3_12) & !is.na(sIgA_3m))
choix_covar <- descrip_num(
  data = choix_covar, 
  vars = c("sIgA_3m",
         "BAYLEYQ4_3_12",
         "BAYLEYQ4_3_24",
         
         "Clusters_Hein_3M",
         "p__Proteobacteria_3M",  
         "p__Firmicutes_3M",
         "p__Bacteroidetes_3M",
         "p__Actinobacteria_3M",
         
         "f__Enterobacteriaceae_g__3M",
         "g__Bacteroides_3M", 
         "g__Bifidobacterium_3M",
         "g__Veillonella_3M", 
         
         "g__Streptococcus_3M",
         "g__Lactobacillus_3M",          
         "g__Enterococcus_3M",
         
         "Cdiff_num_3M",
         "Cdiff_cat_3M",
         
         "metabolite_Acetate", 
         "metabolite_Propionate", 
         "metabolite_Butyrate", 
         "metabolite_Tryptophan", 
         "metabolite_Taurine",
         "metabolite_Lactate",
         "metabolite_Formate",
         
         "Clusters_Hein_Y1",
         "p__Proteobacteria_Y1",  
         "p__Firmicutes_Y1",
         "p__Bacteroidetes_Y1",
         "p__Actinobacteria_Y1", 
         
         "g__Bacteroides_Y1",
         "f__Lachnospiraceae_g___Y1",
         "g__Bifidobacterium_Y1",
         "g__Veillonella_Y1",
         "g__Faecalibacterium_Y1",
         
         "g__Streptococcus_Y1", 
         "g__Lactobacillus_Y1", 
         "g__Enterococcus_Y1", 
         
         "Cdiff_num_Y1", 
         "Cdiff_cat_Y1")) 
```

# Table 1
Description of the participants characteristics (n=178). 
```{r}
table_1 <- bdd %>%
  filter(!is.na(BAYLEYQ4_3_12) & !is.na(sIgA_3m )& !is.na(Clusters_Hein_3M))%>%
  select(
    "Mom_age",
    "mom_bmi_best",       # caractéristiques mère et grossesse
    "Marital_status_2",
    "Mat_education",
    "family_income_3cat", 
    "Ethnicity",
    "Smoke_preg",
    "GA",
    
    "Sex",              # caractéristiques enfant
    "BirthwtKg",
    "Birthmode_2cat",
    "BFStatus3m"
  ) %>% 
  tbl_summary(type = list(GA ~ "continuous", 
                          BirthwtKg ~ "continuous", 
                          Smoke_preg ~ "categorical"), 
              missing = "no", 
              digits = list(GA ~ 0, 
                            Mom_age ~ 0,
                            BirthwtKg ~ 1)) %>%
  bold_labels()
```

# Table 2
Relation between the gut microbiota at 4 months and the Bayley cognitive scores at 12 and 24 months, mediated by sIgA level at 4 months (n=178 and 163 respectively). 
## Functions 
```{r}
nettoyage <- function(fit, name_predictor) {
  table <- 
    bind_rows(
      c(Predictor = {name_predictor}, 
        Mediator = "sIgA at 3 months"), 
      fit) %>%
    filter(op %in% c("~", ":=", NA)) %>%
    mutate(
      est = round(est, digits = 2),
      ci.lower = round(ci.lower, digits = 1), 
      ci.upper = round(ci.upper, digits = 1), 
      pvalue = round(pvalue, digits = 3),
      CI = paste(ci.lower, ci.upper, sep = ", "), 
      label = fct_recode(label, "c'" = "c", "total: c' + (a*b)" = "total")) %>%
    select(
      Predictor, 
      Mediator,
      Path = label, 
      est, 
      CI,
      pvalue) 
  return(table)
}

mediation <- function(model, data) {
  set.seed(1000)
  fit <- 
    sem(model, 
        data = data,
        ordered = "sIgA_3m_cat_CutOff5",
        se = "bootstrap", 
        bootstrap = 5000, 
        estimator = "DWLS")
  fit <- parameterEstimates(fit, ci = TRUE, level = 0.95, boot.ci.type = "perc")
  return(fit)
}
```

## Clusters 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         Clusters_Hein_3M, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         Clusters_Hein_3M, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Clusters_Hein_3M
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*Clusters_Hein_3M
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Clusters_Hein_3M
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*Clusters_Hein_3M
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)
fit_crude_Clusters_Hein_3M_bayley_Y1_bis <- 
  sem(model_crude_Y1, 
      data = bdd_final_Y1,
      ordered = c("Clusters_Hein_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")

table_fit_crude_Clusters_Hein_3M_bayley_Y1_bis <- 
  parameterEstimates(
    fit_crude_Clusters_Hein_3M_bayley_Y1_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)
fit_crude_Clusters_Hein_3M_bayley_Y2_bis <- 
  sem(model_crude_Y2, 
      data = bdd_final_Y2,
      ordered = c("Clusters_Hein_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Hein_3M_bayley_Y2_bis <- 
  parameterEstimates(
    fit_crude_Clusters_Hein_3M_bayley_Y2_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

table_article_Clusters_Hein_3M_bis  <- list(
  table_article_Clusters_Hein_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Clusters_Hein_3M_bayley_Y1_bis, 
              name_predictor = "Enterotypes at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Clusters_Hein_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Clusters_Hein_3M_bayley_Y2_bis, 
              name_predictor = "Enterotypes at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Clusters_Hein_3M_bayley_Y1_bis, 
   table_fit_crude_Clusters_Hein_3M_bayley_Y1_bis, 
   fit_crude_Clusters_Hein_3M_bayley_Y2_bis, 
   table_fit_crude_Clusters_Hein_3M_bayley_Y2_bis)
```

## ln(Proteobacteria_3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Proteobacteria_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Proteobacteria_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Proteobacteria_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*p__Proteobacteria_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Proteobacteria_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*p__Proteobacteria_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Proteobacteria_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Proteobacteria_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Proteobacteria_3M_bis  <- list(
  table_article_Proteobacteria_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Proteobacteria_3M_bayley_Y1_bis, 
              name_predictor = "Proteobacteria at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Proteobacteria_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Proteobacteria_3M_bayley_Y2_bis, 
              name_predictor = "Proteobacteria at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Proteobacteria_3M_bayley_Y1_bis, 
   table_fit_crude_Proteobacteria_3M_bayley_Y1_bis, 
   fit_crude_Proteobacteria_3M_bayley_Y2_bis, 
   table_fit_crude_Proteobacteria_3M_bayley_Y2_bis)
```


## ln(Firmicutes_3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Firmicutes_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Firmicutes_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()


model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Firmicutes_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*p__Firmicutes_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Firmicutes_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*p__Firmicutes_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Firmicutes_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Firmicutes_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Firmicutes_3M_bis  <- list(
  table_article_Firmicutes_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Firmicutes_3M_bayley_Y1_bis, 
              name_predictor = "Firmicutes at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Firmicutes_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Firmicutes_3M_bayley_Y2_bis, 
              name_predictor = "Firmicutes at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Firmicutes_3M_bayley_Y1_bis, 
   table_fit_crude_Firmicutes_3M_bayley_Y1_bis, 
   fit_crude_Firmicutes_3M_bayley_Y2_bis, 
   table_fit_crude_Firmicutes_3M_bayley_Y2_bis)
```

## Bacteroidetes 3M cat --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Bacteroidetes_3M_cat3, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Bacteroidetes_3M_cat3, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Bacteroidetes_3M_cat3
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*p__Bacteroidetes_3M_cat3
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Bacteroidetes_3M_cat3
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*p__Bacteroidetes_3M_cat3
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)
fit_crude_Bacteroidetes_3M_bayley_Y1_bis <- 
  sem(model_crude_Y1, 
      data = bdd_final_Y1,
      ordered = c("p__Bacteroidetes_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")

table_fit_crude_Bacteroidetes_3M_bayley_Y1_bis <- 
  parameterEstimates(
    fit_crude_Bacteroidetes_3M_bayley_Y1_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)
fit_crude_Bacteroidetes_3M_bayley_Y2_bis <- 
  sem(model_crude_Y2, 
      data = bdd_final_Y2,
      ordered = c("p__Bacteroidetes_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_3M_bayley_Y2_bis <- 
  parameterEstimates(
    fit_crude_Bacteroidetes_3M_bayley_Y2_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

table_article_Bacteroidetes_3M_bis  <- list(
  table_article_Bacteroidetes_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Bacteroidetes_3M_bayley_Y1_bis, 
              name_predictor = "Bacteroidetes at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Bacteroidetes_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Bacteroidetes_3M_bayley_Y2_bis, 
              name_predictor = "Bacteroidetes at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Bacteroidetes_3M_bayley_Y1_bis, 
   table_fit_crude_Bacteroidetes_3M_bayley_Y1_bis, 
   fit_crude_Bacteroidetes_3M_bayley_Y2_bis, 
   table_fit_crude_Bacteroidetes_3M_bayley_Y2_bis)
```


## ln(Actinobacteria_3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Actinobacteria_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Actinobacteria_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()


model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Actinobacteria_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*p__Actinobacteria_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Actinobacteria_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*p__Actinobacteria_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Actinobacteria_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Actinobacteria_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Actinobacteria_3M_bis  <- list(
  table_article_Actinobacteria_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Actinobacteria_3M_bayley_Y1_bis, 
              name_predictor = "Actinobacteria at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Actinobacteria_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Actinobacteria_3M_bayley_Y2_bis, 
              name_predictor = "Actinobacteria at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Actinobacteria_3M_bayley_Y1_bis, 
   table_fit_crude_Actinobacteria_3M_bayley_Y1_bis, 
   fit_crude_Actinobacteria_3M_bayley_Y2_bis, 
   table_fit_crude_Actinobacteria_3M_bayley_Y2_bis)
```

## ln(Enterobacteriaceae_g) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         f__Enterobacteriaceae_g__3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         f__Enterobacteriaceae_g__3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()


model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*f__Enterobacteriaceae_g__3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*f__Enterobacteriaceae_g__3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*f__Enterobacteriaceae_g__3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*f__Enterobacteriaceae_g__3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Enterobacteriaceae_g__3M_bis  <- list(
  table_article_Enterobacteriaceae_g__3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_bis, 
              name_predictor = "Enterobacteriaceae (unamed genus) at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Enterobacteriaceae_g__3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_bis, 
              name_predictor = "Enterobacteriaceae (unamed genus) at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_bis, 
   table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_bis, 
   fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_bis, 
   table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_bis)

```

## Bacteroides cat 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Bacteroides_3M_cat3, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Bacteroides_3M_cat3, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()


model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Bacteroides_3M_cat3
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Bacteroides_3M_cat3
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Bacteroides_3M_cat3
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Bacteroides_3M_cat3
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)
fit_crude_Bacteroides_3M_bayley_Y1_bis <- 
  sem(model_crude_Y1, 
      data = bdd_final_Y1,
      ordered = c("g__Bacteroides_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")

table_fit_crude_Bacteroides_3M_bayley_Y1_bis <- 
  parameterEstimates(
    fit_crude_Bacteroides_3M_bayley_Y1_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)
fit_crude_Bacteroides_3M_bayley_Y2_bis <- 
  sem(model_crude_Y2, 
      data = bdd_final_Y2,
      ordered = c("g__Bacteroides_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroides_3M_bayley_Y2_bis <- 
  parameterEstimates(
    fit_crude_Bacteroides_3M_bayley_Y2_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

table_article_Bacteroides_3M_bis  <- list(
  table_article_Bacteroides_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Bacteroides_3M_bayley_Y1_bis, 
              name_predictor = "Bacteroides at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Bacteroides_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Bacteroides_3M_bayley_Y2_bis, 
              name_predictor = "Bacteroides at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Bacteroides_3M_bayley_Y1_bis, 
   table_fit_crude_Bacteroides_3M_bayley_Y1_bis, 
   fit_crude_Bacteroides_3M_bayley_Y2_bis, 
   table_fit_crude_Bacteroides_3M_bayley_Y2_bis)

```

## ln(Bifidobacterium) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Bifidobacterium_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  filter(!g__Bifidobacterium_3M_ln == "-Inf") %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Bifidobacterium_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  filter(!g__Bifidobacterium_3M_ln == "-Inf") %>%
  na.omit()


model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Bifidobacterium_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Bifidobacterium_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Bifidobacterium_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Bifidobacterium_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Bifidobacterium_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Bifidobacterium_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Bifidobacterium_3M_bis  <- list(
  table_article_Bifidobacterium_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Bifidobacterium_3M_bayley_Y1_bis, 
              name_predictor = "Bifidobacterium at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Bifidobacterium_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Bifidobacterium_3M_bayley_Y2_bis, 
              name_predictor = "Bifidobacterium at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Bifidobacterium_3M_bayley_Y1_bis, 
   table_fit_crude_Bifidobacterium_3M_bayley_Y1_bis, 
   fit_crude_Bifidobacterium_3M_bayley_Y2_bis, 
   table_fit_crude_Bifidobacterium_3M_bayley_Y2_bis)

```

## ln(Veillonella) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Veillonella_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  filter(!g__Veillonella_3M_ln == "-Inf") %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Veillonella_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  filter(!g__Veillonella_3M_ln == "-Inf") %>%
  na.omit()


model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Veillonella_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Veillonella_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Veillonella_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Veillonella_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Veillonella_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Veillonella_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Veillonella_3M_bis  <- list(
  table_article_Veillonella_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Veillonella_3M_bayley_Y1_bis, 
              name_predictor = "Veillonella at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Veillonella_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Veillonella_3M_bayley_Y2_bis, 
              name_predictor = "Veillonella at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Veillonella_3M_bayley_Y1_bis, 
   table_fit_crude_Veillonella_3M_bayley_Y1_bis, 
   fit_crude_Veillonella_3M_bayley_Y2_bis, 
   table_fit_crude_Veillonella_3M_bayley_Y2_bis)

```


## ln(Streptococcus_3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Streptococcus_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Streptococcus_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()


model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Streptococcus_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Streptococcus_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Streptococcus_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Streptococcus_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Streptococcus_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Streptococcus_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Streptococcus_3M_bis  <- list(
  table_article_Streptococcus_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Streptococcus_3M_bayley_Y1_bis, 
              name_predictor = "Streptococcus at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Streptococcus_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Streptococcus_3M_bayley_Y2_bis, 
              name_predictor = "Streptococcus at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Streptococcus_3M_bayley_Y1_bis, 
   table_fit_crude_Streptococcus_3M_bayley_Y1_bis, 
   fit_crude_Streptococcus_3M_bayley_Y2_bis, 
   table_fit_crude_Streptococcus_3M_bayley_Y2_bis)
```

## Lactobacillus_3M cat --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Lactobacillus_3M_cat, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Lactobacillus_3M_cat, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()



model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Lactobacillus_3M_cat
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Lactobacillus_3M_cat
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Lactobacillus_3M_cat
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Lactobacillus_3M_cat
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)
fit_crude_Lactobacillus_3M_bayley_Y1_bis <- 
  sem(model_crude_Y1, 
      data = bdd_final_Y1,
      ordered = c("g__Lactobacillus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")

table_fit_crude_Lactobacillus_3M_bayley_Y1_bis <- 
  parameterEstimates(
    fit_crude_Lactobacillus_3M_bayley_Y1_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)
fit_crude_Lactobacillus_3M_bayley_Y2_bis <- 
  sem(model_crude_Y2, 
      data = bdd_final_Y2,
      ordered = c("g__Lactobacillus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_3M_bayley_Y2_bis <- 
  parameterEstimates(
    fit_crude_Lactobacillus_3M_bayley_Y2_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

table_article_Lactobacillus_3M_bis  <- list(
  table_article_Lactobacillus_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Lactobacillus_3M_bayley_Y1_bis, 
              name_predictor = "Lactobacillus at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Lactobacillus_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Lactobacillus_3M_bayley_Y2_bis, 
              name_predictor = "Lactobacillus at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Lactobacillus_3M_bayley_Y1_bis, 
   table_fit_crude_Lactobacillus_3M_bayley_Y1_bis, 
   fit_crude_Lactobacillus_3M_bayley_Y2_bis, 
   table_fit_crude_Lactobacillus_3M_bayley_Y2_bis)
```

## Enterococcus_3M cat --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Enterococcus_3M_cat, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Enterococcus_3M_cat, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Enterococcus_3M_cat
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Enterococcus_3M_cat
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Enterococcus_3M_cat
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Enterococcus_3M_cat
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)
fit_crude_Enterococcus_3M_bayley_Y1_bis <- 
  sem(model_crude_Y1, 
      data = bdd_final_Y1,
      ordered = c("g__Enterococcus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")

table_fit_crude_Enterococcus_3M_bayley_Y1_bis <- 
  parameterEstimates(
    fit_crude_Enterococcus_3M_bayley_Y1_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)
fit_crude_Enterococcus_3M_bayley_Y2_bis <- 
  sem(model_crude_Y2, 
      data = bdd_final_Y2,
      ordered = c("g__Enterococcus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_3M_bayley_Y2_bis <- 
  parameterEstimates(
    fit_crude_Enterococcus_3M_bayley_Y2_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

table_article_Enterococcus_3M_bis  <- list(
  table_article_Enterococcus_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Enterococcus_3M_bayley_Y1_bis, 
              name_predictor = "Enterococcus at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Enterococcus_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Enterococcus_3M_bayley_Y2_bis, 
              name_predictor = "Enterococcus at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Enterococcus_3M_bayley_Y1_bis, 
   table_fit_crude_Enterococcus_3M_bayley_Y1_bis, 
   fit_crude_Enterococcus_3M_bayley_Y2_bis, 
   table_fit_crude_Enterococcus_3M_bayley_Y2_bis)
```

## ln(C Difficile) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_num_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_num_3M_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Cdiff_num_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*Cdiff_num_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Cdiff_num_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*Cdiff_num_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Cdiff_num_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Cdiff_num_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Cdiff_num_3M_bis  <- list(
  table_article_Cdiff_num_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Cdiff_num_3M_bayley_Y1_bis, 
              name_predictor = "C Difficile at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Cdiff_num_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Cdiff_num_3M_bayley_Y2_bis, 
              name_predictor = "C Difficile at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Cdiff_num_3M_bayley_Y1_bis, 
   table_fit_crude_Cdiff_num_3M_bayley_Y1_bis, 
   fit_crude_Cdiff_num_3M_bayley_Y2_bis, 
   table_fit_crude_Cdiff_num_3M_bayley_Y2_bis)
```

## C Difficile cat --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_cat_3M, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_cat_3M, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Cdiff_cat_3M
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*Cdiff_cat_3M
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Cdiff_cat_3M
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*Cdiff_cat_3M
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)
fit_crude_Cdiff_cat_3M_bayley_Y1_bis <- 
  sem(model_crude_Y1, 
      data = bdd_final_Y1,
      ordered = c("Cdiff_cat_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")

table_fit_crude_Cdiff_cat_3M_bayley_Y1_bis <- 
  parameterEstimates(
    fit_crude_Cdiff_cat_3M_bayley_Y1_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)
fit_crude_Cdiff_cat_3M_bayley_Y2_bis <- 
  sem(model_crude_Y2, 
      data = bdd_final_Y2,
      ordered = c("Cdiff_cat_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_3M_bayley_Y2_bis <- 
  parameterEstimates(
    fit_crude_Cdiff_cat_3M_bayley_Y2_bis, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

table_article_Cdiff_cat_3M_bis  <- list(
  table_article_Cdiff_cat_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Cdiff_cat_3M_bayley_Y1_bis, 
              name_predictor = "C Difficile at 3 months (cat)") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Cdiff_cat_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Cdiff_cat_3M_bayley_Y2_bis, 
              name_predictor = "C Difficile at 3 months (cat)") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Cdiff_cat_3M_bayley_Y1_bis, 
   table_fit_crude_Cdiff_cat_3M_bayley_Y1_bis, 
   fit_crude_Cdiff_cat_3M_bayley_Y2_bis, 
   table_fit_crude_Cdiff_cat_3M_bayley_Y2_bis)
```

## ln(Acetate) 3M --> sIgA 3M --> Bayley 
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Acetate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Acetate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()


model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Acetate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Acetate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Acetate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Acetate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'


# Crude model, Bayley 1Y
table_fit_crude_Acetate_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Acetate_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Acetate_3M_bis  <- list(
  table_article_Acetate_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Acetate_3M_bayley_Y1_bis, 
              name_predictor = "Acetate metabolite at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Acetate_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Acetate_3M_bayley_Y2_bis, 
              name_predictor = "Acetate metabolite at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Acetate_3M_bayley_Y1_bis, 
   table_fit_crude_Acetate_3M_bayley_Y1_bis, 
   fit_crude_Acetate_3M_bayley_Y2_bis, 
   table_fit_crude_Acetate_3M_bayley_Y2_bis)
```

## ln(Propionate) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Propionate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Propionate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Propionate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Propionate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Propionate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Propionate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Propionate_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Propionate_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Propionate_3M_bis  <- list(
  table_article_Propionate_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Propionate_3M_bayley_Y1_bis, 
              name_predictor = "Propionate metabolite at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Propionate_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Propionate_3M_bayley_Y2_bis, 
              name_predictor = "Propionate metabolite at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Propionate_3M_bayley_Y1_bis, 
   table_fit_crude_Propionate_3M_bayley_Y1_bis, 
   fit_crude_Propionate_3M_bayley_Y2_bis, 
   table_fit_crude_Propionate_3M_bayley_Y2_bis)
```

## ln(Butyrate) 3M --> sIgA 3M --> Bayley 
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Butyrate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Butyrate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Butyrate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Butyrate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Butyrate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Butyrate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Butyrate_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Butyrate_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Butyrate_3M_bis  <- list(
  table_article_Butyrate_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Butyrate_3M_bayley_Y1_bis, 
              name_predictor = "Butyrate metabolite at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Butyrate_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Butyrate_3M_bayley_Y2_bis, 
              name_predictor = "Butyrate metabolite at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Butyrate_3M_bayley_Y1_bis, 
   table_fit_crude_Butyrate_3M_bayley_Y1_bis, 
   fit_crude_Butyrate_3M_bayley_Y2_bis, 
   table_fit_crude_Butyrate_3M_bayley_Y2_bis)
```


## ln(Tryptophan) 3M --> sIgA 3M --> Bayley 
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Tryptophan_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Tryptophan_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Tryptophan_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Tryptophan_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Tryptophan_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Tryptophan_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Tryptophan_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Tryptophan_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Tryptophan_3M_bis  <- list(
  table_article_Tryptophan_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Tryptophan_3M_bayley_Y1_bis, 
              name_predictor = "Tryptophan metabolite at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Tryptophan_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Tryptophan_3M_bayley_Y2_bis, 
              name_predictor = "Tryptophan metabolite at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Tryptophan_3M_bayley_Y1_bis, 
   table_fit_crude_Tryptophan_3M_bayley_Y1_bis, 
   fit_crude_Tryptophan_3M_bayley_Y2_bis, 
   table_fit_crude_Tryptophan_3M_bayley_Y2_bis)
```


## Taurine 3M --> sIgA 3M --> Bayley 
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Taurine, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Taurine, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Taurine
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Taurine
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Taurine
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Taurine
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Taurine_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Taurine_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Taurine_3M_bis  <- list(
  table_article_Taurine_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Taurine_3M_bayley_Y1_bis, 
              name_predictor = "Taurine metabolite at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Taurine_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Taurine_3M_bayley_Y2_bis, 
              name_predictor = "Taurine metabolite at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Taurine_3M_bayley_Y1_bis, 
   table_fit_crude_Taurine_3M_bayley_Y1_bis, 
   fit_crude_Taurine_3M_bayley_Y2_bis, 
   table_fit_crude_Taurine_3M_bayley_Y2_bis)
```

## ln(Lactate) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Lactate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Lactate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Lactate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Lactate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Lactate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Lactate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Lactate_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Lactate_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Lactate_3M_bis  <- list(
  table_article_Lactate_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Lactate_3M_bayley_Y1_bis, 
              name_predictor = "Lactate metabolite at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Lactate_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Lactate_3M_bayley_Y2_bis, 
              name_predictor = "Lactate metabolite at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Lactate_3M_bayley_Y1_bis, 
   table_fit_crude_Lactate_3M_bayley_Y1_bis, 
   fit_crude_Lactate_3M_bayley_Y2_bis, 
   table_fit_crude_Lactate_3M_bayley_Y2_bis)
```

## ln(Formate) 3M --> sIgA 3M --> Bayley 
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Formate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Formate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Formate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Formate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Formate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Formate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Formate_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Formate_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Formate_3M_bis  <- list(
  table_article_Formate_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Formate_3M_bayley_Y1_bis, 
              name_predictor = "Formate metabolite at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Formate_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Formate_3M_bayley_Y2_bis, 
              name_predictor = "Formate metabolite at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Formate_3M_bayley_Y1_bis, 
   table_fit_crude_Formate_3M_bayley_Y1_bis, 
   fit_crude_Formate_3M_bayley_Y2_bis, 
   table_fit_crude_Formate_3M_bayley_Y2_bis)
```

## ln(Tyrosine) 3M --> sIgA 3M --> Bayley 
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Tyrosine_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Tyrosine_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Tyrosine_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Tyrosine_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Tyrosine_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Tyrosine_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Tyrosine_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Tyrosine_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Tyrosine_3M_bis  <- list(
  table_article_Tyrosine_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Tyrosine_3M_bayley_Y1_bis, 
              name_predictor = "Tyrosine metabolite at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Tyrosine_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Tyrosine_3M_bayley_Y2_bis, 
              name_predictor = "Tyrosine metabolite at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Tyrosine_3M_bayley_Y1_bis, 
   table_fit_crude_Tyrosine_3M_bayley_Y1_bis, 
   fit_crude_Tyrosine_3M_bayley_Y2_bis, 
   table_fit_crude_Tyrosine_3M_bayley_Y2_bis)
```

## ln(Valerate) 3M --> sIgA 3M --> Bayley 
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Valerate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         metabolite_Valerate_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Valerate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Valerate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Valerate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Valerate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Valerate_3M_bayley_Y1_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Valerate_3M_bayley_Y2_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Valerate_3M_bis  <- list(
  table_article_Valerate_3M_bayley_Y1_bis = 
    nettoyage(fit = table_fit_crude_Valerate_3M_bayley_Y1_bis, 
              name_predictor = "Valerate metabolite at 3 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Valerate_3M_bayley_Y2_bis =
    nettoyage(fit = table_fit_crude_Valerate_3M_bayley_Y2_bis, 
              name_predictor = "Valerate metabolite at 3 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Valerate_3M_bayley_Y1_bis, 
   table_fit_crude_Valerate_3M_bayley_Y1_bis, 
   fit_crude_Valerate_3M_bayley_Y2_bis, 
   table_fit_crude_Valerate_3M_bayley_Y2_bis)
```

```{r}
rm(mediation, nettoyage)
```


# Table 3
Relation between sIgA level at 4 months and the Bayley cognitive scores at 12 and 24 months, mediated by the gut microbiota at 12 months (n=170 and 154 respectively).
## Fonctions
```{r}
nettoyage <- function(fit, name_mediator) {
  table <- 
    bind_rows(
      c(Mediator = {name_mediator}, 
        Predictor = "sIgA at 3 months"), 
      fit) %>%
    filter(op %in% c("~", ":=", NA)) %>%
    mutate(
      est = round(est, digits = 2),
      ci.lower = round(ci.lower, digits = 1), 
      ci.upper = round(ci.upper, digits = 1), 
      pvalue = round(pvalue, digits = 3),
      CI = paste(ci.lower, ci.upper, sep = ", "), 
      label = fct_recode(label, "c'" = "c", "total: c' + (a*b)" = "total")) %>%
    select(
      Predictor, 
      Mediator,
      Path = label, 
      est, 
      CI,
      pvalue) 
  return(table)
}

mediation <- function(model, data) {
  set.seed(1000)
  fit <- 
    sem(model, 
        data = data,
        ordered = "sIgA_3m_cat_CutOff5",
        se = "bootstrap", 
        bootstrap = 5000, 
        estimator = "DWLS")
  fit <- parameterEstimates(fit, ci = TRUE, level = 0.95, boot.ci.type = "perc")
  return(fit)
}
```
## sIgA 3M --> Clusters 12M --> Bayley
```{r sIgA 3M --> Clusters 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         Clusters_Hein_Y1, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         Clusters_Hein_Y1, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
Clusters_Hein_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*Clusters_Hein_Y1 + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
Clusters_Hein_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*Clusters_Hein_Y1 + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)
fit_crude_Clusters_Y1_bayley_Y1 <- 
  sem(model_crude_Y1, 
      data = bdd_final_Y1,
      ordered = c("Clusters_Hein_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Y1_bayley_Y1 <- 
  parameterEstimates(
    fit_crude_Clusters_Y1_bayley_Y1, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)
fit_crude_Clusters_Y1_bayley_Y2 <- 
  sem(model_crude_Y2, 
      data = bdd_final_Y2,
      ordered = c("Clusters_Hein_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Y1_bayley_Y2 <- 
  parameterEstimates(
    fit_crude_Clusters_Y1_bayley_Y2, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

table_article_Clusters_Y1  <- list(
  
  table_article_Clusters_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Clusters_Y1_bayley_Y1, name_mediator = "Clusters at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Clusters_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Clusters_Y1_bayley_Y2, name_mediator = "Clusters at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Clusters_Y1_bayley_Y1, 
   table_fit_crude_Clusters_Y1_bayley_Y1, 
   fit_crude_Clusters_Y1_bayley_Y2, 
   table_fit_crude_Clusters_Y1_bayley_Y2)
```

## sIgA 3M --> Proteobacteria ln 12M --> Bayley
```{r sIgA 3M --> Proteobacteria 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Proteobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Proteobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
p__Proteobacteria_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*p__Proteobacteria_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
p__Proteobacteria_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*p__Proteobacteria_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Proteobacteria_Y1_bayley_Y1 <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Proteobacteria_Y1_bayley_Y2 <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Proteobacteria_Y1  <- list(
  table_article_Proteobacteria_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Proteobacteria_Y1_bayley_Y1, 
              name_mediator = "Proteobacteria at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Proteobacteria_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Proteobacteria_Y1_bayley_Y2, 
              name_mediator = "Proteobacteria at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Proteobacteria_Y1_bayley_Y1, 
   table_fit_crude_Proteobacteria_Y1_bayley_Y1, 
   fit_crude_Proteobacteria_Y1_bayley_Y2, 
   table_fit_crude_Proteobacteria_Y1_bayley_Y2)
```

## sIgA 3M --> Firmicutes ln 12M --> Bayley
```{r sIgA 3M --> Firmicutes 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Firmicutes_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Firmicutes_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
p__Firmicutes_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*p__Firmicutes_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
p__Firmicutes_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*p__Firmicutes_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Firmicutes_Y1_bayley_Y1 <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Firmicutes_Y1_bayley_Y2 <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Firmicutes_Y1  <- list(
  table_article_Firmicutes_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Firmicutes_Y1_bayley_Y1, 
              name_mediator = "Firmicutes at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Firmicutes_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Firmicutes_Y1_bayley_Y2, 
              name_mediator = "Firmicutes at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Firmicutes_Y1_bayley_Y1, 
   table_fit_crude_Firmicutes_Y1_bayley_Y1, 
   fit_crude_Firmicutes_Y1_bayley_Y2, 
   table_fit_crude_Firmicutes_Y1_bayley_Y2)
```

## sIgA 3M --> Bacteroidetes cat 12M --> Bayley
```{r sIgA 3M --> Bacteroidetes 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Bacteroidetes_Y1_cat3, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Bacteroidetes_Y1_cat3, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
p__Bacteroidetes_Y1_cat3 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*p__Bacteroidetes_Y1_cat3 + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
p__Bacteroidetes_Y1_cat3 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*p__Bacteroidetes_Y1_cat3 + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)
fit_crude_Bacteroidetes_Y1_bayley_Y1 <- 
  sem(model_crude_Y1, 
      data = bdd_final_Y1,
      ordered = c("p__Bacteroidetes_Y1_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_Y1_bayley_Y1 <- 
  parameterEstimates(
    fit_crude_Bacteroidetes_Y1_bayley_Y1, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)
fit_crude_Bacteroidetes_Y1_bayley_Y2 <- 
  sem(model_crude_Y2, 
      data = bdd_final_Y2,
      ordered = c("p__Bacteroidetes_Y1_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_Y1_bayley_Y2 <- 
  parameterEstimates(
    fit_crude_Bacteroidetes_Y1_bayley_Y2, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

table_article_Bacteroidetes_Y1  <- list(
  table_article_Bacteroidetes_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Bacteroidetes_Y1_bayley_Y1, 
              name_mediator = "Bacteroidetes at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Bacteroidetes_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Bacteroidetes_Y1_bayley_Y2, 
              name_mediator = "Bacteroidetes at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Bacteroidetes_Y1_bayley_Y1, 
   table_fit_crude_Bacteroidetes_Y1_bayley_Y1, 
   fit_crude_Bacteroidetes_Y1_bayley_Y2, 
   table_fit_crude_Bacteroidetes_Y1_bayley_Y2)
```

## sIgA 3M --> Actinobacteria ln 12M --> Bayley
```{r sIgA 3M --> Actinobacteria 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Actinobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Actinobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
p__Actinobacteria_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*p__Actinobacteria_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
p__Actinobacteria_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*p__Actinobacteria_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Actinobacteria_Y1_bayley_Y1 <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Actinobacteria_Y1_bayley_Y2 <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Actinobacteria_Y1  <- list(
  table_article_Actinobacteria_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Actinobacteria_Y1_bayley_Y1, 
              name_mediator = "Actinobacteria at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Actinobacteria_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Actinobacteria_Y1_bayley_Y2, 
              name_mediator = "Actinobacteria at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Actinobacteria_Y1_bayley_Y1, 
   table_fit_crude_Actinobacteria_Y1_bayley_Y1, 
   fit_crude_Actinobacteria_Y1_bayley_Y2, 
   table_fit_crude_Actinobacteria_Y1_bayley_Y2)
```


## sIgA 3M --> Bacteroides 12M --> Bayley
```{r message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Bacteroides_Y1,  # la variable non log transformé a une meilleure distribution
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Bacteroides_Y1, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
g__Bacteroides_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Bacteroides_Y1 + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Bacteroides_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Bacteroides_Y1 + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Bacteroides_Y1_bayley_Y1 <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Bacteroides_Y1_bayley_Y2 <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Bacteroides_Y1  <- list(
  table_article_Bacteroides_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Bacteroides_Y1_bayley_Y1, 
              name_mediator = "Bacteroides at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Bacteroides_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Bacteroides_Y1_bayley_Y2, 
              name_mediator = "Bacteroides at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Bacteroides_Y1_bayley_Y1, 
   table_fit_crude_Bacteroides_Y1_bayley_Y1, 
   fit_crude_Bacteroides_Y1_bayley_Y2, 
   table_fit_crude_Bacteroides_Y1_bayley_Y2)
```

## sIgA 3M --> Lachnospiraceae_g__ ln 12M --> Bayley
```{r sIgA 3M --> Lachnospiraceae_g__ 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         f__Lachnospiraceae_g___Y1_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit() %>%
  filter(!f__Lachnospiraceae_g___Y1_ln == "-Inf")

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         f__Lachnospiraceae_g___Y1_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()%>%
  filter(!f__Lachnospiraceae_g___Y1_ln == "-Inf")

model_crude_Y1 <- '# simple mediation
f__Lachnospiraceae_g___Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*f__Lachnospiraceae_g___Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
f__Lachnospiraceae_g___Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*f__Lachnospiraceae_g___Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1 <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y2 <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Lachnospiraceae_g_Y1  <- list(
  table_article_Lachnospiraceae_g_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1, 
              name_mediator = "Lachnospiraceae_g at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Lachnospiraceae_g_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y2, 
              name_mediator = "Lachnospiraceae_g at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Lachnospiraceae_g__Y1_bayley_Y1, 
   table_fit_crude_Lachnospiraceae_g__Y1_bayley_Y1, 
   fit_crude_Lachnospiraceae_g__Y1_bayley_Y2, 
   table_fit_crude_Lachnospiraceae_g__Y1_bayley_Y2)
```

## sIgA 3M --> Bifidobacterium ln 12M --> Bayley
```{r sIgA 3M --> Bifidobacterium ln 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Bifidobacterium_Y1_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit() %>%
  filter(!g__Bifidobacterium_Y1_ln == "-Inf")

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Bifidobacterium_Y1_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()%>%
  filter(!g__Bifidobacterium_Y1_ln == "-Inf")

model_crude_Y1 <- '# simple mediation
g__Bifidobacterium_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Bifidobacterium_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Bifidobacterium_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Bifidobacterium_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Bifidobacterium_Y1_bayley_Y1 <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Bifidobacterium_Y1_bayley_Y2 <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Bifidobacterium_Y1  <- list(
  table_article_Bifidobacterium_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Bifidobacterium_Y1_bayley_Y1, 
              name_mediator = "Bifidobacterium at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Bifidobacterium_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Bifidobacterium_Y1_bayley_Y2, 
              name_mediator = "Bifidobacterium at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Bifidobacterium_Y1_bayley_Y1, 
   table_fit_crude_Bifidobacterium_Y1_bayley_Y1, 
   fit_crude_Bifidobacterium_Y1_bayley_Y2, 
   table_fit_crude_Bifidobacterium_Y1_bayley_Y2)
```

## sIgA 3M --> Veillonella ln 12M --> Bayley
```{r sIgA 3M --> Veillonella ln 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Veillonella_Y1_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Veillonella_Y1_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
g__Veillonella_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Veillonella_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Veillonella_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Veillonella_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Veillonella_Y1_bayley_Y1 <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Veillonella_Y1_bayley_Y2 <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Veillonella_Y1  <- list(
  table_article_Veillonella_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Veillonella_Y1_bayley_Y1, 
              name_mediator = "Veillonella at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Veillonella_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Veillonella_Y1_bayley_Y2, 
              name_mediator = "Veillonella at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Veillonella_Y1_bayley_Y1, 
   table_fit_crude_Veillonella_Y1_bayley_Y1, 
   fit_crude_Veillonella_Y1_bayley_Y2, 
   table_fit_crude_Veillonella_Y1_bayley_Y2)
```

## sIgA 3M --> Faecalibacterium ln 12M --> Bayley
```{r sIgA 3M --> Faecalibacterium ln 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Faecalibacterium_Y1_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()%>%
  filter(!g__Faecalibacterium_Y1_ln == "-Inf")

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Faecalibacterium_Y1_ln, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()%>%
  filter(!g__Faecalibacterium_Y1_ln == "-Inf")

model_crude_Y1 <- '# simple mediation
g__Faecalibacterium_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Faecalibacterium_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Faecalibacterium_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Faecalibacterium_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Faecalibacterium_Y1_bayley_Y1 <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Faecalibacterium_Y1_bayley_Y2 <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Faecalibacterium_Y1  <- list(
  table_article_Faecalibacterium_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Faecalibacterium_Y1_bayley_Y1, 
              name_mediator = "Faecalibacterium at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Faecalibacterium_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Faecalibacterium_Y1_bayley_Y2, 
              name_mediator = "Faecalibacterium at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Faecalibacterium_Y1_bayley_Y1, 
   table_fit_crude_Faecalibacterium_Y1_bayley_Y1, 
   fit_crude_Faecalibacterium_Y1_bayley_Y2, 
   table_fit_crude_Faecalibacterium_Y1_bayley_Y2)
```

## sIgA 3M --> ln(Streptococcus_Y1) --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Streptococcus_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(!g__Streptococcus_Y1_ln =="-Inf")

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Streptococcus_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()%>%
  filter(!g__Streptococcus_Y1_ln =="-Inf")

model_crude_Y1 <- '# simple mediation
g__Streptococcus_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Streptococcus_Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Streptococcus_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Streptococcus_Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Streptococcus_Y1_bayley_Y1 <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Streptococcus_Y1_bayley_Y2 <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Streptococcus_Y1  <- list(
  table_article_Streptococcus_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Streptococcus_Y1_bayley_Y1, name_mediator = "Streptococcus at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Streptococcus_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Streptococcus_Y1_bayley_Y2, name_mediator = "Streptococcus at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Streptococcus_Y1_bayley_Y1, 
   table_fit_crude_Streptococcus_Y1_bayley_Y1, 
   fit_crude_Streptococcus_Y1_bayley_Y2, 
   table_fit_crude_Streptococcus_Y1_bayley_Y2)
```

## sIgA 3M --> Lactobacillus Y1 cat --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Lactobacillus_Y1_cat, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Lactobacillus_Y1_cat, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
g__Lactobacillus_Y1_cat ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Lactobacillus_Y1_cat + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Lactobacillus_Y1_cat ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Lactobacillus_Y1_cat + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)
fit_crude_Lactobacillus_Y1_bayley_Y1 <- 
  sem(model_crude_Y1, 
      data = bdd_final_Y1,
      ordered = c("g__Lactobacillus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")

table_fit_crude_Lactobacillus_Y1_bayley_Y1 <- 
  parameterEstimates(
    fit_crude_Lactobacillus_Y1_bayley_Y1, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)
fit_crude_Lactobacillus_Y1_bayley_Y2 <- 
  sem(model_crude_Y2, 
      data = bdd_final_Y2,
      ordered = c("g__Lactobacillus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_Y1_bayley_Y2 <- 
  parameterEstimates(
    fit_crude_Lactobacillus_Y1_bayley_Y2, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

table_article_Lactobacillus_Y1  <- list(
  table_article_Lactobacillus_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Lactobacillus_Y1_bayley_Y1, name_mediator = "Lactobacillus at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Lactobacillus_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Lactobacillus_Y1_bayley_Y2, name_mediator = "Lactobacillus at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Lactobacillus_Y1_bayley_Y1, 
   table_fit_crude_Lactobacillus_Y1_bayley_Y1, 
   fit_crude_Lactobacillus_Y1_bayley_Y2, 
   table_fit_crude_Lactobacillus_Y1_bayley_Y2)
```

## sIgA 3M --> Enterococcus Y1 cat --> Bayley
```{r}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         g__Enterococcus_Y1_cat, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         g__Enterococcus_Y1_cat, 
         Sex, GA, Birthmode_2cat) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
g__Enterococcus_Y1_cat ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Enterococcus_Y1_cat + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Enterococcus_Y1_cat ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Enterococcus_Y1_cat + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)
fit_crude_Enterococcus_Y1_bayley_Y1 <- 
  sem(model_crude_Y1, 
      data = bdd_final_Y1,
      ordered = c("g__Enterococcus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")

table_fit_crude_Enterococcus_Y1_bayley_Y1 <- 
  parameterEstimates(
    fit_crude_Enterococcus_Y1_bayley_Y1, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)
fit_crude_Enterococcus_Y1_bayley_Y2 <- 
  sem(model_crude_Y2, 
      data = bdd_final_Y2,
      ordered = c("g__Enterococcus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_Y1_bayley_Y2 <- 
  parameterEstimates(
    fit_crude_Enterococcus_Y1_bayley_Y2, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

table_article_Enterococcus_Y1  <- list(
  table_article_Enterococcus_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Enterococcus_Y1_bayley_Y1, name_mediator = "Enterococcus at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Enterococcus_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Enterococcus_Y1_bayley_Y2, name_mediator = "Enterococcus at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Enterococcus_Y1_bayley_Y1, 
   table_fit_crude_Enterococcus_Y1_bayley_Y1, 
   fit_crude_Enterococcus_Y1_bayley_Y2, 
   table_fit_crude_Enterococcus_Y1_bayley_Y2)
```


## sIgA 3M --> C Difficile num 12M --> Bayley
```{r sIgA 3M --> C Difficile num 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_num_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_num_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
Cdiff_num_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*Cdiff_num_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
Cdiff_num_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*Cdiff_num_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
table_fit_crude_Cdiff_num_Y1_bayley_Y1 <- mediation(model = model_crude_Y1, data = bdd_final_Y1)

# Crude model, Bayley 2Y
table_fit_crude_Cdiff_num_Y1_bayley_Y2 <- mediation(model = model_crude_Y2, data = bdd_final_Y2)

table_article_Cdiff_num_Y1  <- list(
  table_article_Cdiff_num_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Cdiff_num_Y1_bayley_Y1, 
              name_mediator = "C difficile (num) at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Cdiff_num_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Cdiff_num_Y1_bayley_Y2, 
              name_mediator = "C difficile (num) at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Cdiff_num_Y1_bayley_Y1, 
   table_fit_crude_Cdiff_num_Y1_bayley_Y1, 
   fit_crude_Cdiff_num_Y1_bayley_Y2, 
   table_fit_crude_Cdiff_num_Y1_bayley_Y2)
```

## sIgA 3M --> C Difficile cat 12M --> Bayley
```{r sIgA 3M --> C Difficile cat 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_cat_Y1, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

bdd_final_Y2 <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_cat_Y1, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit()

model_crude_Y1 <- '# simple mediation
Cdiff_cat_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*Cdiff_cat_Y1 + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
Cdiff_cat_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*Cdiff_cat_Y1 + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)
fit_crude_Cdiff_cat_Y1_bayley_Y1 <- 
  sem(model_crude_Y1, 
      data = bdd_final_Y1,
      ordered = c("Cdiff_cat_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_Y1_bayley_Y1 <- 
  parameterEstimates(
    fit_crude_Cdiff_cat_Y1_bayley_Y1, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)
fit_crude_Cdiff_cat_Y1_bayley_Y2 <- 
  sem(model_crude_Y2, 
      data = bdd_final_Y2,
      ordered = c("Cdiff_cat_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap", 
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_Y1_bayley_Y2 <- 
  parameterEstimates(
    fit_crude_Cdiff_cat_Y1_bayley_Y2, 
    ci = TRUE, 
    level = 0.95, 
    boot.ci.type = "perc")

table_article_Cdiff_cat_Y1  <- list(
  table_article_Cdiff_cat_Y1_bayley_Y1 = 
    nettoyage(fit = table_fit_crude_Cdiff_cat_Y1_bayley_Y1, 
              name_mediator = "C difficile (cat) at 12 months") %>%
    rename("Est Y1" = est, "CI Y1" = CI, "p-value Y1" = pvalue),
  
  table_article_Cdiff_cat_Y1_bayley_Y2 =
    nettoyage(fit = table_fit_crude_Cdiff_cat_Y1_bayley_Y2, 
              name_mediator = "C difficile (cat) at 12 months") %>%
    rename("Est Y2" = est, "CI Y2" = CI, "p-value Y2" = pvalue))%>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

rm(fit_crude_Cdiff_cat_Y1_bayley_Y1, 
   table_fit_crude_Cdiff_cat_Y1_bayley_Y1, 
   fit_crude_Cdiff_cat_Y1_bayley_Y2, 
   table_fit_crude_Cdiff_cat_Y1_bayley_Y2)
```

```{r}
rm(mediation, nettoyage)
```

# Figure 1
Gut microbiota distribution at 4 months depending on secretory IgA level at 4 months of age 
```{r}
bdd_figure_1_long <- bdd_filtered %>%
  select(ident, 
         sIgA_3m_cat_CutOff5, 
         
         p__Proteobacteria_3M,
         p__Firmicutes_3M, 
         p__Bacteroidetes_3M, 
         p__Actinobacteria_3M, 
         f__Enterobacteriaceae_g__3M, 
         g__Bacteroides_3M, 
         g__Bifidobacterium_3M, 
         g__Veillonella_3M, 
         g__Streptococcus_3M_ln, 
         g__Lactobacillus_3M_ln, 
         g__Enterococcus_3M_ln, 
         Cdiff_num_3M_ln, 
         
         metabolite_Acetate_ln, 
         metabolite_Propionate_ln, 
         metabolite_Butyrate_ln, 
         metabolite_Tryptophan_ln, 
         #metabolite_Taurine_ln, 
         metabolite_Lactate_ln, 
         metabolite_Formate_ln, 
         metabolite_Tyrosine_ln, 
         metabolite_Valerate_ln) 

var_lab(bdd_figure_1_long$p__Proteobacteria_3M) <- NULL
var_lab(bdd_figure_1_long$p__Firmicutes_3M) <- NULL
var_lab(bdd_figure_1_long$p__Bacteroidetes_3M) <- NULL
var_lab(bdd_figure_1_long$p__Actinobacteria_3M) <- NULL
var_lab(bdd_figure_1_long$f__Enterobacteriaceae_g__3M) <- NULL
var_lab(bdd_figure_1_long$g__Bacteroides_3M) <- NULL
var_lab(bdd_figure_1_long$g__Bifidobacterium_3M) <- NULL
var_lab(bdd_figure_1_long$g__Veillonella_3M) <- NULL
var_lab(bdd_figure_1_long$g__Streptococcus_3M_ln) <- NULL
var_lab(bdd_figure_1_long$g__Lactobacillus_3M_ln) <- NULL
var_lab(bdd_figure_1_long$g__Enterococcus_3M_ln) <- NULL
var_lab(bdd_figure_1_long$Cdiff_num_3M_ln) <- NULL

var_lab(bdd_figure_1_long$metabolite_Acetate_ln) <- NULL
var_lab(bdd_figure_1_long$metabolite_Propionate_ln) <- NULL
var_lab(bdd_figure_1_long$metabolite_Butyrate_ln) <- NULL
var_lab(bdd_figure_1_long$metabolite_Tryptophan_ln) <- NULL
#var_lab(bdd_figure_1_long$metabolite_Taurine_ln) <- NULL
var_lab(bdd_figure_1_long$metabolite_Lactate_ln) <- NULL
var_lab(bdd_figure_1_long$metabolite_Formate_ln) <- NULL
var_lab(bdd_figure_1_long$metabolite_Tyrosine_ln) <- NULL
var_lab(bdd_figure_1_long$metabolite_Valerate_ln) <- NULL

bdd_figure_1_long <- bdd_figure_1_long %>%
  rename("Proteobacteria" = p__Proteobacteria_3M,
         "Firmicutes" = p__Firmicutes_3M, 
         "Bacteroidetes" = p__Bacteroidetes_3M, 
         "Actinobacteria" = p__Actinobacteria_3M, 
         "Enterobacteriaceae \n (unknown genus)" = f__Enterobacteriaceae_g__3M, 
         "Bacteroides" = g__Bacteroides_3M, 
         "Bifidobacterium" = g__Bifidobacterium_3M, 
         "Veillonella"  = g__Veillonella_3M, 
         "Streptococcus" = g__Streptococcus_3M_ln, 
         "Lactobacillus" = g__Lactobacillus_3M_ln, 
         "Enterococcus" = g__Enterococcus_3M_ln, 
         "Clostridium difficile" = Cdiff_num_3M_ln, 
         "Acetate" = metabolite_Acetate_ln, 
         "Propionate" = metabolite_Propionate_ln, 
         "Butyrate" = metabolite_Butyrate_ln, 
         "Tryptophan" = metabolite_Tryptophan_ln, 
         #"Taurine" = metabolite_Taurine_ln, 
         "Lactate" = metabolite_Lactate_ln, 
         "Formate" = metabolite_Formate_ln, 
         "Tyrosine" = metabolite_Tyrosine_ln, 
         "Valerate" = metabolite_Valerate_ln) %>%
  pivot_longer(cols = c(-sIgA_3m_cat_CutOff5, -ident))%>%
  mutate(
    name = fct_relevel(name,
                       "Proteobacteria", 
                       "Firmicutes",
                       "Bacteroidetes",  
                       "Actinobacteria",
                       "Enterobacteriaceae \n (unknown genus)", 
                       "Bacteroides", 
                       "Bifidobacterium", 
                       "Veillonella", 
                       
                       "Streptococcus",
                       "Lactobacillus", 
                       "Enterococcus",
                       "Clostridium difficile", 
                       
                       "Acetate","Propionate","Butyrate","Tryptophan",
                       #"Taurine",
                       "Lactate","Formate", "Tyrosine","Valerate"), 
    sIgA_3m_cat_CutOff5 = fct_recode(sIgA_3m_cat_CutOff5,
                                     "≥5 ng/g feces" = ">=5 ng/dL", 
                                     "<5 ng/g feces" = "<5 ng/dL"))


figure_1_a <- bdd_figure_1_long %>%
 filter(name %in% c("Proteobacteria", 
                       "Firmicutes",
                       "Bacteroidetes",  
                       "Actinobacteria",
                       "Enterobacteriaceae \n (unknown genus)", 
                       "Bacteroides", 
                       "Bifidobacterium", 
                       "Veillonella")) %>%
 ggplot() +
  aes(x = value, y = name, fill = sIgA_3m_cat_CutOff5) +
  geom_boxplot() +
  scale_fill_hue(direction = 1) +
  labs(
    x = "Relative abundances at 4 months",
    y = "",
    title = "(a)",
    fill = "Secretory IgA level at 4 months"
  ) +
  theme_bw() +
  theme(
    axis.title.y = element_blank(),
    axis.title.x = element_text(size = 12L), 
    axis.text = element_text(size = 12L), 
    legend.position = "none")

figure_1_c <- bdd_figure_1_long %>%
 filter(name %in% c("Acetate","Propionate","Butyrate","Tryptophan",
                    #"Taurine",
                    "Lactate","Formate", "Tyrosine","Valerate")) %>%
 ggplot() +
  aes(x = value, y = name, fill = sIgA_3m_cat_CutOff5) +
  geom_boxplot() +
  scale_fill_hue(direction = 1) +
  #scale_x_continuous(trans = "log") +
  labs(
    x = "Metabolites levels 4 months (log transformed)",
    y = "",
    title = "(c)",
    fill = "Secretory IgA level at 4 months"
  ) +
  theme_bw() +
  theme(
    axis.title.y = element_blank(),
    axis.title.x = element_text(size = 12L), 
    axis.text = element_text(size = 12L), 
    legend.position = "none")

figure_1_b <- bdd_figure_1_long %>%
 filter(name %in% c("Streptococcus", "Lactobacillus", "Enterococcus", "Clostridium difficile")) %>%
 ggplot() +
  aes(x = value, y = name, fill = sIgA_3m_cat_CutOff5) +
  geom_boxplot() +
  scale_fill_hue(direction = 1) +
  #scale_x_continuous(trans = "log") +
  labs(
    x = "Relative abundances at 4 months (log transformed)",
    fill = "Secretory IgA level at 4 months",
    title = "(b)"
  ) +
  theme_bw() +
  theme(
    axis.title.y = element_blank(),
    axis.title.x = element_text(size = 12L), 
    axis.text = element_text(size = 12L), 
    legend.position = "none")

legend <- bdd_figure_1_long %>%
 filter(name %in% c("Streptococcus", "Lactobacillus", "Enterococcus", "Clostridium difficile")) %>%
 ggplot() +
  aes(x = value, y = name, fill = sIgA_3m_cat_CutOff5) +
  geom_boxplot() +
  scale_fill_hue(direction = 1) +
  #scale_x_continuous(trans = "log") +
  labs(
    x = "Relative abundances at 4 months \n (log transformed)",
    fill = "Secretory IgA level at 4 months"
  ) +
  theme_bw() +
  theme(
    axis.title.y = element_blank(),
    axis.title.x = element_text(size = 12L), 
    axis.text = element_text(size = 12L), 
    legend.text = element_text(size = 12L), 
    legend.title = element_text(size = 12L), 
    legend.direction = "horizontal") 

legend <- get_legend(legend)

figure_1 <- 
  figure_1_a / figure_1_b /figure_1_c  /  legend + 
  plot_layout(ncol = 1, heights = c(10, 5, 10, 1))

rm(bdd_figure_1_long, figure_1_a, figure_1_b, figure_1_c, legend)

ggsave(plot = figure_1, 
       filename = "C:/Users/Aline/OneDrive - etu.univ-grenoble-alpes.fr/Documents/10. Symbiota lab project/figures/article/figure_1.tiff",
       units = "mm", 
       height = 250, 
       width = 300)
```

# Figure 2
Mediation main results
```{r}

```

# Figure S1
Direct Acyclic Graph of the relation between gut microbiota at 4 months and Bayley cognitive scores in infancy, mediated by child secretory IgA level at 4 months.
```{r eval=FALSE, include=FALSE}
cf Daggity
```

# Figure S2
Direct Acyclic Graph of the relation between secretory IgA level at 4 months and Bayley cognitive scores in infancy, mediated by child gut microbiota at 12 months.
```{r eval=FALSE, include=FALSE}
cf Daggity
```


# Figure S3
Spearman correlations between gut microbiota variables at 4 and 12 months of age. 
```{r echo=FALSE, fig.height=12, fig.width=11, message=FALSE, warning=FALSE}
figure_S3 <- bdd_filtered %>% 
  select(p__Proteobacteria_3M,
         p__Firmicutes_3M, 
         p__Bacteroidetes_3M, 
         p__Actinobacteria_3M, 
         f__Enterobacteriaceae_g__3M, 
         g__Bacteroides_3M, 
         g__Bifidobacterium_3M, 
         g__Veillonella_3M, 
         g__Streptococcus_3M, 
         g__Lactobacillus_3M, 
         g__Enterococcus_3M, 
         Cdiff_num_3M, 
         metabolite_Acetate, 
         metabolite_Propionate, 
         metabolite_Butyrate, 
         metabolite_Tryptophan, 
         metabolite_Taurine, 
         metabolite_Lactate, 
         metabolite_Formate, 
         metabolite_Tyrosine, 
         metabolite_Valerate, 
         
         p__Proteobacteria_Y1, 
         p__Firmicutes_Y1, 
         p__Bacteroidetes_Y1,  
         p__Actinobacteria_Y1, 
         g__Bacteroides_Y1, 
         f__Lachnospiraceae_g___Y1, 
         g__Bifidobacterium_Y1,  
         g__Veillonella_Y1,  
         g__Faecalibacterium_Y1, 
         g__Streptococcus_Y1,  
         g__Lactobacillus_Y1, 
         g__Enterococcus_Y1, 
         Cdiff_num_Y1) %>%
  rename(`Lachnospiraceae Y1` = f__Lachnospiraceae_g___Y1, 
         `Enterobacteriaceae M4` = f__Enterobacteriaceae_g__3M, ) %>%
  rename_with(~ gsub("p__", "", .x)) %>%
  rename_with(~ gsub("g__", "", .x)) %>%
  rename_with(~ gsub("_Y1", " Y1", .x)) %>%
  rename_with(~ gsub("_3M", " M4", .x)) %>%
  rename_with(~ gsub("metabolite_", "", .x)) %>%
  rename_with(~ gsub("Cdiff_num", "Clostridium difficile", .x)) %>%
  rename(`Acetate metabolite M4` = Acetate, 
         `Propionate metabolite M4` = Propionate, 
         `Butyrate metabolite M4` = Butyrate, 
         `Tryptophan metabolite M4` = Tryptophan, 
         `Taurine metabolite M4` = Taurine, 
         `Lactate metabolite M4` = Lactate, 
         `Formate metabolite M4` = Formate, 
         `Tyrosine metabolite M4` = Tyrosine, 
         `Valerate metabolite M4` = Valerate) %>%
  select(
    'Clostridium difficile Y1',
  'Enterococcus Y1',
  'Lactobacillus Y1',
  'Streptococcus Y1',
  'Faecalibacterium Y1',
  'Veillonella Y1',
  'Bifidobacterium Y1',
  'Lachnospiraceae Y1',
  'Bacteroides Y1',
  'Actinobacteria Y1',
  'Bacteroidetes Y1',
  'Firmicutes Y1',
  'Proteobacteria Y1',
  'Valerate metabolite M4',
  'Tyrosine metabolite M4',
  'Formate metabolite M4',
  'Lactate metabolite M4',
  'Taurine metabolite M4',
  'Tryptophan metabolite M4',
  'Butyrate metabolite M4',
  'Propionate metabolite M4',
  'Acetate metabolite M4',
  'Clostridium difficile M4',
  'Enterococcus M4',
  'Lactobacillus M4',
  'Streptococcus M4',
  'Veillonella M4',
  'Bifidobacterium M4',
  'Bacteroides M4',
  'Enterobacteriaceae M4',
  'Actinobacteria M4',
  'Bacteroidetes M4',
  'Firmicutes M4',
  'Proteobacteria M4'
  )

order <- c('Clostridium difficile Y1',
  'Enterococcus Y1',
  'Lactobacillus Y1',
  'Streptococcus Y1',
  'Faecalibacterium Y1',
  'Veillonella Y1',
  'Bifidobacterium Y1',
  'Lachnospiraceae Y1',
  'Bacteroides Y1',
  'Actinobacteria Y1',
  'Bacteroidetes Y1',
  'Firmicutes Y1',
  'Proteobacteria Y1',
  'Valerate metabolite M4',
  'Tyrosine metabolite M4',
  'Formate metabolite M4',
  'Lactate metabolite M4',
  'Taurine metabolite M4',
  'Tryptophan metabolite M4',
  'Butyrate metabolite M4',
  'Propionate metabolite M4',
  'Acetate metabolite M4',
  'Clostridium difficile M4',
  'Enterococcus M4',
  'Lactobacillus M4',
  'Streptococcus M4',
  'Veillonella M4',
  'Bifidobacterium M4',
  'Bacteroides M4',
  'Enterobacteriaceae M4',
  'Actinobacteria M4',
  'Bacteroidetes M4',
  'Firmicutes M4',
  'Proteobacteria M4')

figure_S3 <- 
  cor(figure_S3, method = "spearman", use = "pairwise.complete.obs") %>%
  as.data.frame() %>%
  rownames_to_column("var") %>%
  select(var, 
  'Clostridium difficile Y1',
  'Enterococcus Y1',
  'Lactobacillus Y1',
  'Streptococcus Y1',
  'Faecalibacterium Y1',
  'Veillonella Y1',
  'Bifidobacterium Y1',
  'Lachnospiraceae Y1',
  'Bacteroides Y1',
  'Actinobacteria Y1',
  'Bacteroidetes Y1',
  'Firmicutes Y1',
  'Proteobacteria Y1',
  'Valerate metabolite M4',
  'Tyrosine metabolite M4',
  'Formate metabolite M4',
  'Lactate metabolite M4',
  'Taurine metabolite M4',
  'Tryptophan metabolite M4',
  'Butyrate metabolite M4',
  'Propionate metabolite M4',
  'Acetate metabolite M4',
  'Clostridium difficile M4',
  'Enterococcus M4',
  'Lactobacillus M4',
  'Streptococcus M4',
  'Veillonella M4',
  'Bifidobacterium M4',
  'Bacteroides M4',
  'Enterobacteriaceae M4',
  'Actinobacteria M4',
  'Bacteroidetes M4',
  'Firmicutes M4',
  'Proteobacteria M4') %>%
  mutate(
    var = fct_relevel(var, order)) %>%
  column_to_rownames("var") %>%
  as.matrix()
  
my_palette <- colorRampPalette(c("blue", "white", "red"))(200)
tiff(filename = "4_output/figure_S3.tiff", units = "mm", width = 250, height = 250, res = 300)
corrplot(figure_S3, 
         method = "color", # Méthode de coloration
         type = "lower",   # Affiche seulement le triangle inférieur
         order = "hclust", # Optionnel: ordonner les variables selon un clustering hiérarchique
         tl.col = "black", # Couleur du texte pour les noms des variables
         tl.srt = 45,      # Orientation des noms des variables (45 degrés)
         tl.cex = 0.7, 
         addCoef.col = "black", # Couleur des coefficients de corrélation
         number.cex = 0.7, # Taille des coefficients de corrélation
         number.digits = 1,
         col = my_palette,
         diag = TRUE)

```



# Figure S4
Gut microbiota distribution at 12 months depending on secretory IgA level at 4 months of age 
```{r}
bdd_figure_S3_long <- bdd_filtered %>%
  select(ident, 
         sIgA_3m_cat_CutOff5, 
         p__Proteobacteria_Y1, 
         p__Firmicutes_Y1, 
         p__Bacteroidetes_Y1,
         p__Actinobacteria_Y1, 
         g__Bacteroides_Y1,
         f__Lachnospiraceae_g___Y1, 
         g__Bifidobacterium_Y1, 
         g__Veillonella_Y1, 
         g__Faecalibacterium_Y1, 
         g__Streptococcus_Y1_ln, 
         g__Lactobacillus_Y1_ln,
         g__Enterococcus_Y1_ln,
         Cdiff_num_Y1_ln) 

var_lab(bdd_figure_S3_long$p__Proteobacteria_Y1) <- NULL
var_lab(bdd_figure_S3_long$p__Firmicutes_Y1) <- NULL
var_lab(bdd_figure_S3_long$p__Bacteroidetes_Y1) <- NULL
var_lab(bdd_figure_S3_long$p__Actinobacteria_Y1) <- NULL
var_lab(bdd_figure_S3_long$g__Bacteroides_Y1) <- NULL
var_lab(bdd_figure_S3_long$f__Lachnospiraceae_g___Y1) <- NULL
var_lab(bdd_figure_S3_long$g__Bifidobacterium_Y1) <- NULL
var_lab(bdd_figure_S3_long$g__Veillonella_Y1) <- NULL
var_lab(bdd_figure_S3_long$g__Faecalibacterium_Y1) <- NULL
var_lab(bdd_figure_S3_long$g__Streptococcus_Y1_ln) <- NULL
var_lab(bdd_figure_S3_long$g__Lactobacillus_Y1_ln) <- NULL
var_lab(bdd_figure_S3_long$g__Enterococcus_Y1_ln) <- NULL
var_lab(bdd_figure_S3_long$Cdiff_num_Y1_ln) <- NULL


bdd_figure_S3_long <- bdd_figure_S3_long %>%
  rename("Proteobacteria" = p__Proteobacteria_Y1,
         "Firmicutes" = p__Firmicutes_Y1, 
         "Bacteroidetes" = p__Bacteroidetes_Y1, 
         "Actinobacteria" = p__Actinobacteria_Y1, 
         "Bacteroides" = g__Bacteroides_Y1, 
         "Lachnospiraceae \n (unknown genus)" = f__Lachnospiraceae_g___Y1, 
         "Bifidobacterium" = g__Bifidobacterium_Y1, 
         "Veillonella"  = g__Veillonella_Y1, 
         "Faecalibacterium" = g__Faecalibacterium_Y1,
         "Streptococcus" = g__Streptococcus_Y1_ln, 
         "Lactobacillus" = g__Lactobacillus_Y1_ln, 
         "Enterococcus" = g__Enterococcus_Y1_ln, 
         "Clostridium difficile" = Cdiff_num_Y1_ln) %>%
  pivot_longer(cols = c(-sIgA_3m_cat_CutOff5, -ident))%>%
  mutate(
    name = fct_relevel(name,
    "Clostridium difficile", "Enterococcus", "Lactobacillus", "Streptococcus",
    "Veillonella", "Bifidobacterium", "Faecalibacterium", "Lachnospiraceae \n (unknown genus)",
    "Bacteroides", "Proteobacteria", "Actinobacteria",
    "Bacteroidetes", "Firmicutes"),
    sIgA_3m_cat_CutOff5 = fct_recode(sIgA_3m_cat_CutOff5,
                                     "≥5 ng/dL" = ">=5 ng/dL"))


figure_S3_a <- bdd_figure_S3_long %>%
 filter(name %in% c("Proteobacteria", 
                    "Firmicutes",
                    "Bacteroidetes",  
                    "Actinobacteria",
                    "Lachnospiraceae \n (unknown genus)", 
                    "Bacteroides", 
                    "Bifidobacterium", 
                    "Veillonella", 
                    "Faecalibacterium")) %>%
 ggplot() +
  aes(x = value, y = name, fill = sIgA_3m_cat_CutOff5) +
  geom_boxplot() +
  scale_fill_hue(direction = 1) +
  labs(
    x = "Relative abundances at 12 months",
    y = "",
    title = "(a)",
    fill = "Secretory IgA level at 4 months"
  ) +
  theme_bw() +
  theme(
    axis.title.y = element_blank(),
    axis.title.x = element_text(size = 12L), 
    axis.text = element_text(size = 12L), 
    legend.position = "none")

figure_S3_b <- bdd_figure_S3_long %>%
 filter(name %in% c("Streptococcus", "Lactobacillus", "Enterococcus", "Clostridium difficile")) %>%
 ggplot() +
  aes(x = value, y = name, fill = sIgA_3m_cat_CutOff5) +
  geom_boxplot() +
  scale_fill_hue(direction = 1) +
  #scale_x_continuous(trans = "log") +
  labs(
    x = "Relative abundances at 12 months (log transformed)",
    fill = "Secretory IgA level at 4 months",
    title = "(b)"
  ) +
  theme_bw() +
  theme(
    axis.title.y = element_blank(),
    axis.title.x = element_text(size = 12L), 
    axis.text = element_text(size = 12L),
    legend.text = element_text(size = 12L),
    legend.title = element_text(size = 12L),
    legend.position = "bottom")

figure_S3 <- figure_S3_a + figure_S3_b + plot_layout(ncol = 1, heights = c(2, 1))

rm(figure_S3_a, figure_S3_b, bdd_figure_S3_long)

ggsave(plot = figure_S3, 
       filename = "C:/Users/Aline/OneDrive - etu.univ-grenoble-alpes.fr/Documents/10. Symbiota lab project/figures/article/figure_S3.tiff", 
       units = "mm", 
       height = 200, 
       width = 300)
```


# Table S1
Description of the sIgA level at 3 months of age, the gut microbiota at 3 and 12 months of age and the Bayley cognitive scale at 12 and 24 months of age in the children from the Canadian CHILD study cohort.
```{r}
table_S1.1 <- descrip_num(
  data = bdd_filtered, 
  vars = c("sIgA_3m",
         "BAYLEYQ4_3_12",
         "BAYLEYQ4_3_24",
         
         "p__Proteobacteria_3M",  
         "p__Firmicutes_3M",
         "p__Bacteroidetes_3M",
         "p__Actinobacteria_3M",
         
         "f__Enterobacteriaceae_g__3M",
         "g__Bacteroides_3M", 
         "g__Bifidobacterium_3M",
         "g__Veillonella_3M", 
         
         "g__Streptococcus_3M",
         "g__Lactobacillus_3M",          
         "g__Enterococcus_3M",
         
         "Cdiff_num_3M",
         
         "metabolite_Acetate", 
         "metabolite_Propionate", 
         "metabolite_Butyrate", 
         "metabolite_Tryptophan", 
         "metabolite_Taurine",
         "metabolite_Lactate",
         "metabolite_Formate",
         
         "p__Proteobacteria_Y1",  
         "p__Firmicutes_Y1",
         "p__Bacteroidetes_Y1",
         "p__Actinobacteria_Y1", 
         
         "g__Bacteroides_Y1",
         "f__Lachnospiraceae_g___Y1",
         "g__Bifidobacterium_Y1",
         "g__Veillonella_Y1",
         "g__Faecalibacterium_Y1",
         
         "g__Lactobacillus_Y1", 
         "g__Enterococcus_Y1", 
         "g__Streptococcus_Y1", 
         
         "Cdiff_num_Y1")) %>% 
  select(-`Variable names`)

table_S1.2 <- bdd %>%
  filter(!is.na(BAYLEYQ4_3_12) & !is.na(sIgA_3m )& !is.na(Clusters_Hein_3M))%>%
  select(Clusters_Hein_3M, 
         Cdiff_cat_3M, 
         Clusters_Hein_Y1, 
         Cdiff_cat_Y1)  %>% 
  tbl_summary(missing = "no", 
              type = list(Cdiff_cat_3M ~ "categorical", 
                          Cdiff_cat_Y1 ~ "categorical")) %>%
  bold_labels()

#write.xlsx(table_2b, file = "C:/Users/Aline/OneDrive - etu.univ-grenoble-alpes.fr/Documents/10. Symbiota lab project/table_2b.xlsx")
```

# Tables S2 and S3
Relation between gut microbiota at 3 months and Bayley cognitive scores at 12 and 24 months, mediated by sIgA level at 3 months, stratified by breastfeeding status at 3 months.
## Functions 
```{r}
nettoyage <- function(fit, name_predictor) {
  table <- 
    bind_rows(
      c(Predictor = {name_predictor}, 
        Mediator = "sIgA at 3 months"), 
      fit) %>%
    filter(op %in% c("~", ":=", NA)) %>%
    mutate(
      est = round(est, digits = 2),
      ci.lower = round(ci.lower, digits = 1), 
      ci.upper = round(ci.upper, digits = 1), 
      pvalue = round(pvalue, digits = 3),
      CI = paste(ci.lower, ci.upper, sep = ", "), 
      label = fct_recode(label, "c'" = "c", "total: c' + (a*b)" = "total")) %>%
    select(
      Predictor, 
      Mediator,
      Path = label, 
      est, 
      CI,
      pvalue) 
  return(table)
}

mediation <- function(model, data) {
  set.seed(1000)
  fit <- 
    sem(model, 
        data = data,
        ordered = "sIgA_3m_cat_CutOff5",
        se = "bootstrap", 
        bootstrap = 5000, 
        estimator = "DWLS")
  fit <- parameterEstimates(fit, ci = TRUE, level = 0.95, boot.ci.type = "perc")
  return(fit)
}
```


## Clusters 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Clusters_Hein_3M
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*Clusters_Hein_3M
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Clusters_Hein_3M
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*Clusters_Hein_3M
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)                         # exlusive
fit_crude_Clusters_Hein_3M_bayley_Y1_exclusive_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_exclusive,
      ordered = c("Clusters_Hein_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Hein_3M_bayley_Y1_exclusive_bis <-
  parameterEstimates(
    fit_crude_Clusters_Hein_3M_bayley_Y1_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                            # partial
fit_crude_Clusters_Hein_3M_bayley_Y1_partial_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_partial,
      ordered = c("Clusters_Hein_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Hein_3M_bayley_Y1_partial_bis <-
  parameterEstimates(
    fit_crude_Clusters_Hein_3M_bayley_Y1_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                          # none
fit_crude_Clusters_Hein_3M_bayley_Y1_none_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_none,
      ordered = c("Clusters_Hein_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Hein_3M_bayley_Y1_none_bis <-
  parameterEstimates(
    fit_crude_Clusters_Hein_3M_bayley_Y1_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)                                  # exlusive
fit_crude_Clusters_Hein_3M_bayley_Y2_exclusive_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_exclusive,
      ordered = c("Clusters_Hein_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Hein_3M_bayley_Y2_exclusive_bis <-
  parameterEstimates(
    fit_crude_Clusters_Hein_3M_bayley_Y2_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                                  # partial
fit_crude_Clusters_Hein_3M_bayley_Y2_partial_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_partial,
      ordered = c("Clusters_Hein_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Hein_3M_bayley_Y2_partial_bis <-
  parameterEstimates(
    fit_crude_Clusters_Hein_3M_bayley_Y2_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                              # none
fit_crude_Clusters_Hein_3M_bayley_Y2_none_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_none,
      ordered = c("Clusters_Hein_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Hein_3M_bayley_Y2_none_bis <-
  parameterEstimates(
    fit_crude_Clusters_Hein_3M_bayley_Y2_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

table_fit_crude_Clusters_Hein_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Clusters_Hein_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Clusters_Hein_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Enterotypes at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Clusters_Hein_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Clusters_Hein_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Enterotypes at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Clusters_Hein_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Clusters_Hein_3M_bayley_Y1_partial_bis, 
              name_predictor = "Enterotypes at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Clusters_Hein_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Clusters_Hein_3M_bayley_Y2_partial_bis, 
              name_predictor = "Enterotypes at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Clusters_Hein_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Clusters_Hein_3M_bayley_Y1_none_bis, 
              name_predictor = "Enterotypes at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Clusters_Hein_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Clusters_Hein_3M_bayley_Y2_none_bis, 
              name_predictor = "Enterotypes at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(Proteobacteria_3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Proteobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Proteobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Proteobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Proteobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Proteobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Proteobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Proteobacteria_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*p__Proteobacteria_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Proteobacteria_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*p__Proteobacteria_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Proteobacteria_3M_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Proteobacteria_3M_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Proteobacteria_3M_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Proteobacteria_3M_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Proteobacteria_3M_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Proteobacteria_3M_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Proteobacteria_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Proteobacteria_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Proteobacteria_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Proteobacteria at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Proteobacteria_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Proteobacteria_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Proteobacteria at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Proteobacteria_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Proteobacteria_3M_bayley_Y1_partial_bis, 
              name_predictor = "Proteobacteria at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Proteobacteria_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Proteobacteria_3M_bayley_Y2_partial_bis, 
              name_predictor = "Proteobacteria at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Proteobacteria_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Proteobacteria_3M_bayley_Y1_none_bis, 
              name_predictor = "Proteobacteria at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Proteobacteria_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Proteobacteria_3M_bayley_Y2_none_bis, 
              name_predictor = "Proteobacteria at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```


## ln(Firmicutes_3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Firmicutes_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Firmicutes_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Firmicutes_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Firmicutes_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Firmicutes_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Firmicutes_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Firmicutes_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*p__Firmicutes_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Firmicutes_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*p__Firmicutes_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Firmicutes_3M_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Firmicutes_3M_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Firmicutes_3M_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Firmicutes_3M_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Firmicutes_3M_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Firmicutes_3M_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Firmicutes_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Firmicutes_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Firmicutes_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Firmicutes at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Firmicutes_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Firmicutes_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Firmicutes at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Firmicutes_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Firmicutes_3M_bayley_Y1_partial_bis, 
              name_predictor = "Firmicutes at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Firmicutes_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Firmicutes_3M_bayley_Y2_partial_bis, 
              name_predictor = "Firmicutes at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Firmicutes_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Firmicutes_3M_bayley_Y1_none_bis, 
              name_predictor = "Firmicutes at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Firmicutes_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Firmicutes_3M_bayley_Y2_none_bis, 
              name_predictor = "Firmicutes at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## Bacteroidetes 3M cat --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Bacteroidetes_3M_cat3
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*p__Bacteroidetes_3M_cat3
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Bacteroidetes_3M_cat3
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*p__Bacteroidetes_3M_cat3
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)                         # exlusive
fit_crude_Bacteroidetes_3M_bayley_Y1_exclusive_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_exclusive,
      ordered = c("p__Bacteroidetes_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_3M_bayley_Y1_exclusive_bis <-
  parameterEstimates(
    fit_crude_Bacteroidetes_3M_bayley_Y1_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                            # partial
fit_crude_Bacteroidetes_3M_bayley_Y1_partial_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_partial,
      ordered = c("p__Bacteroidetes_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_3M_bayley_Y1_partial_bis <-
  parameterEstimates(
    fit_crude_Bacteroidetes_3M_bayley_Y1_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                          # none
fit_crude_Bacteroidetes_3M_bayley_Y1_none_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_none,
      ordered = c("p__Bacteroidetes_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_3M_bayley_Y1_none_bis <-
  parameterEstimates(
    fit_crude_Bacteroidetes_3M_bayley_Y1_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)                                  # exlusive
fit_crude_Bacteroidetes_3M_bayley_Y2_exclusive_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_exclusive,
      ordered = c("p__Bacteroidetes_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_3M_bayley_Y2_exclusive_bis <-
  parameterEstimates(
    fit_crude_Bacteroidetes_3M_bayley_Y2_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                                  # partial
fit_crude_Bacteroidetes_3M_bayley_Y2_partial_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_partial,
      ordered = c("p__Bacteroidetes_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_3M_bayley_Y2_partial_bis <-
  parameterEstimates(
    fit_crude_Bacteroidetes_3M_bayley_Y2_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                              # none
fit_crude_Bacteroidetes_3M_bayley_Y2_none_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_none,
      ordered = c("p__Bacteroidetes_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_3M_bayley_Y2_none_bis <-
  parameterEstimates(
    fit_crude_Bacteroidetes_3M_bayley_Y2_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

table_fit_crude_Bacteroidetes_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Bacteroidetes_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Bacteroidetes_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Bacteroidetes at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Bacteroidetes_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Bacteroidetes_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Bacteroidetes at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Bacteroidetes_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Bacteroidetes_3M_bayley_Y1_partial_bis, 
              name_predictor = "Bacteroidetes at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Bacteroidetes_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Bacteroidetes_3M_bayley_Y2_partial_bis, 
              name_predictor = "Bacteroidetes at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Bacteroidetes_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Bacteroidetes_3M_bayley_Y1_none_bis, 
              name_predictor = "Bacteroidetes at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Bacteroidetes_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Bacteroidetes_3M_bayley_Y2_none_bis, 
              name_predictor = "Bacteroidetes at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```


## ln(Actinobacteria_3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Actinobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Actinobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Actinobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Actinobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Actinobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Actinobacteria_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Actinobacteria_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*p__Actinobacteria_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*p__Actinobacteria_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*p__Actinobacteria_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Actinobacteria_3M_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Actinobacteria_3M_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Actinobacteria_3M_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Actinobacteria_3M_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Actinobacteria_3M_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Actinobacteria_3M_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Actinobacteria_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Actinobacteria_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Actinobacteria_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Actinobacteria at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Actinobacteria_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Actinobacteria_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Actinobacteria at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Actinobacteria_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Actinobacteria_3M_bayley_Y1_partial_bis, 
              name_predictor = "Actinobacteria at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Actinobacteria_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Actinobacteria_3M_bayley_Y2_partial_bis, 
              name_predictor = "Actinobacteria at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Actinobacteria_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Actinobacteria_3M_bayley_Y1_none_bis, 
              name_predictor = "Actinobacteria at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Actinobacteria_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Actinobacteria_3M_bayley_Y2_none_bis, 
              name_predictor = "Actinobacteria at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(Enterobacteriaceae_g) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         f__Enterobacteriaceae_g__3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         f__Enterobacteriaceae_g__3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         f__Enterobacteriaceae_g__3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         f__Enterobacteriaceae_g__3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         f__Enterobacteriaceae_g__3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         f__Enterobacteriaceae_g__3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*f__Enterobacteriaceae_g__3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*f__Enterobacteriaceae_g__3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*f__Enterobacteriaceae_g__3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*f__Enterobacteriaceae_g__3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Enterobacteriaceae (unamed genus) at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Enterobacteriaceae (unamed genus) at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_partial_bis, 
              name_predictor = "Enterobacteriaceae (unamed genus) at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_partial_bis, 
              name_predictor = "Enterobacteriaceae (unamed genus) at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_none_bis, 
              name_predictor = "Enterobacteriaceae (unamed genus) at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y2_none_bis, 
              name_predictor = "Enterobacteriaceae (unamed genus) at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

```

## Bacteroides cat 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_3M_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Bacteroides_3M_cat3
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Bacteroides_3M_cat3
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Bacteroides_3M_cat3
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Bacteroides_3M_cat3
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)                         # exlusive
fit_crude_Bacteroides_3M_bayley_Y1_exclusive_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_exclusive,
      ordered = c("g__Bacteroides_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroides_3M_bayley_Y1_exclusive_bis <-
  parameterEstimates(
    fit_crude_Bacteroides_3M_bayley_Y1_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                            # partial
fit_crude_Bacteroides_3M_bayley_Y1_partial_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_partial,
      ordered = c("g__Bacteroides_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroides_3M_bayley_Y1_partial_bis <-
  parameterEstimates(
    fit_crude_Bacteroides_3M_bayley_Y1_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                          # none
fit_crude_Bacteroides_3M_bayley_Y1_none_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_none,
      ordered = c("g__Bacteroides_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroides_3M_bayley_Y1_none_bis <-
  parameterEstimates(
    fit_crude_Bacteroides_3M_bayley_Y1_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)                                  # exlusive
fit_crude_Bacteroides_3M_bayley_Y2_exclusive_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_exclusive,
      ordered = c("g__Bacteroides_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroides_3M_bayley_Y2_exclusive_bis <-
  parameterEstimates(
    fit_crude_Bacteroides_3M_bayley_Y2_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                                  # partial
fit_crude_Bacteroides_3M_bayley_Y2_partial_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_partial,
      ordered = c("g__Bacteroides_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroides_3M_bayley_Y2_partial_bis <-
  parameterEstimates(
    fit_crude_Bacteroides_3M_bayley_Y2_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                              # none
fit_crude_Bacteroides_3M_bayley_Y2_none_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_none,
      ordered = c("g__Bacteroides_3M_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroides_3M_bayley_Y2_none_bis <-
  parameterEstimates(
    fit_crude_Bacteroides_3M_bayley_Y2_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

table_fit_crude_Bacteroides_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Bacteroides_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Bacteroides_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Bacteroides at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Bacteroides_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Bacteroides_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Bacteroides at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Bacteroides_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Bacteroides_3M_bayley_Y1_partial_bis, 
              name_predictor = "Bacteroides at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Bacteroides_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Bacteroides_3M_bayley_Y2_partial_bis, 
              name_predictor = "Bacteroides at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Bacteroides_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Bacteroides_3M_bayley_Y1_none_bis, 
              name_predictor = "Bacteroides at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Bacteroides_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Bacteroides_3M_bayley_Y2_none_bis, 
              name_predictor = "Bacteroides at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(Bifidobacterium) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive") %>%
  filter(!g__Bifidobacterium_3M_ln == "-Inf")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")%>%
  filter(!g__Bifidobacterium_3M_ln == "-Inf")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!g__Bifidobacterium_3M_ln == "-Inf")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!g__Bifidobacterium_3M_ln == "-Inf")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!g__Bifidobacterium_3M_ln == "-Inf")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!g__Bifidobacterium_3M_ln == "-Inf")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Bifidobacterium_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Bifidobacterium_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Bifidobacterium_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Bifidobacterium_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Bifidobacterium_3M_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Bifidobacterium_3M_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Bifidobacterium_3M_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Bifidobacterium_3M_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Bifidobacterium_3M_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Bifidobacterium_3M_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Bifidobacterium_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Bifidobacterium_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Bifidobacterium_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Bifidobacterium at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Bifidobacterium_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Bifidobacterium_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Bifidobacterium at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Bifidobacterium_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Bifidobacterium_3M_bayley_Y1_partial_bis, 
              name_predictor = "Bifidobacterium at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Bifidobacterium_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Bifidobacterium_3M_bayley_Y2_partial_bis, 
              name_predictor = "Bifidobacterium at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Bifidobacterium_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Bifidobacterium_3M_bayley_Y1_none_bis, 
              name_predictor = "Bifidobacterium at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Bifidobacterium_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Bifidobacterium_3M_bayley_Y2_none_bis, 
              name_predictor = "Bifidobacterium at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(Veillonella) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")%>%
  filter(!g__Veillonella_3M_ln == "-Inf")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")%>%
  filter(!g__Veillonella_3M_ln == "-Inf")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!g__Veillonella_3M_ln == "-Inf")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!g__Veillonella_3M_ln == "-Inf")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!g__Veillonella_3M_ln == "-Inf")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!g__Veillonella_3M_ln == "-Inf")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Veillonella_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Veillonella_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Veillonella_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Veillonella_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Veillonella_3M_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Veillonella_3M_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Veillonella_3M_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Veillonella_3M_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Veillonella_3M_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Veillonella_3M_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Veillonella_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Veillonella_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Veillonella_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Veillonella at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Veillonella_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Veillonella_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Veillonella at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Veillonella_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Veillonella_3M_bayley_Y1_partial_bis, 
              name_predictor = "Veillonella at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Veillonella_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Veillonella_3M_bayley_Y2_partial_bis, 
              name_predictor = "Veillonella at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Veillonella_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Veillonella_3M_bayley_Y1_none_bis, 
              name_predictor = "Veillonella at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Veillonella_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Veillonella_3M_bayley_Y2_none_bis, 
              name_predictor = "Veillonella at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(Streptococcus_3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Streptococcus_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Streptococcus_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Streptococcus_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Streptococcus_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Streptococcus_3M_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Streptococcus_3M_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Streptococcus_3M_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Streptococcus_3M_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Streptococcus_3M_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Streptococcus_3M_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Streptococcus_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Streptococcus_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Streptococcus_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Streptococcus at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Streptococcus_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Streptococcus_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Streptococcus at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Streptococcus_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Streptococcus_3M_bayley_Y1_partial_bis, 
              name_predictor = "Streptococcus at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Streptococcus_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Streptococcus_3M_bayley_Y2_partial_bis, 
              name_predictor = "Streptococcus at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Streptococcus_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Streptococcus_3M_bayley_Y1_none_bis, 
              name_predictor = "Streptococcus at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Streptococcus_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Streptococcus_3M_bayley_Y2_none_bis, 
              name_predictor = "Streptococcus at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## Lactobacillus_3M cat --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Lactobacillus_3M_cat
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Lactobacillus_3M_cat
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Lactobacillus_3M_cat
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Lactobacillus_3M_cat
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)                         # exlusive
fit_crude_Lactobacillus_3M_bayley_Y1_exclusive_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_exclusive,
      ordered = c("g__Lactobacillus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_3M_bayley_Y1_exclusive_bis <-
  parameterEstimates(
    fit_crude_Lactobacillus_3M_bayley_Y1_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                            # partial
fit_crude_Lactobacillus_3M_bayley_Y1_partial_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_partial,
      ordered = c("g__Lactobacillus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_3M_bayley_Y1_partial_bis <-
  parameterEstimates(
    fit_crude_Lactobacillus_3M_bayley_Y1_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                          # none
fit_crude_Lactobacillus_3M_bayley_Y1_none_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_none,
      ordered = c("g__Lactobacillus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_3M_bayley_Y1_none_bis <-
  parameterEstimates(
    fit_crude_Lactobacillus_3M_bayley_Y1_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)                                  # exlusive
fit_crude_Lactobacillus_3M_bayley_Y2_exclusive_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_exclusive,
      ordered = c("g__Lactobacillus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_3M_bayley_Y2_exclusive_bis <-
  parameterEstimates(
    fit_crude_Lactobacillus_3M_bayley_Y2_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                                  # partial
fit_crude_Lactobacillus_3M_bayley_Y2_partial_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_partial,
      ordered = c("g__Lactobacillus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_3M_bayley_Y2_partial_bis <-
  parameterEstimates(
    fit_crude_Lactobacillus_3M_bayley_Y2_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                              # none
fit_crude_Lactobacillus_3M_bayley_Y2_none_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_none,
      ordered = c("g__Lactobacillus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_3M_bayley_Y2_none_bis <-
  parameterEstimates(
    fit_crude_Lactobacillus_3M_bayley_Y2_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

table_fit_crude_Lactobacillus_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Lactobacillus_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Lactobacillus_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Lactobacillus at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Lactobacillus_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Lactobacillus_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Lactobacillus at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Lactobacillus_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Lactobacillus_3M_bayley_Y1_partial_bis, 
              name_predictor = "Lactobacillus at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Lactobacillus_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Lactobacillus_3M_bayley_Y2_partial_bis, 
              name_predictor = "Lactobacillus at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Lactobacillus_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Lactobacillus_3M_bayley_Y1_none_bis, 
              name_predictor = "Lactobacillus at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Lactobacillus_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Lactobacillus_3M_bayley_Y2_none_bis, 
              name_predictor = "Lactobacillus at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## Enterococcus_3M cat --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Enterococcus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Enterococcus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Enterococcus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Enterococcus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Enterococcus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Enterococcus_3M_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Enterococcus_3M_cat
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*g__Enterococcus_3M_cat
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*g__Enterococcus_3M_cat
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*g__Enterococcus_3M_cat
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)                         # exlusive
fit_crude_Enterococcus_3M_bayley_Y1_exclusive_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_exclusive,
      ordered = c("g__Enterococcus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_3M_bayley_Y1_exclusive_bis <-
  parameterEstimates(
    fit_crude_Enterococcus_3M_bayley_Y1_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                            # partial
fit_crude_Enterococcus_3M_bayley_Y1_partial_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_partial,
      ordered = c("g__Enterococcus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_3M_bayley_Y1_partial_bis <-
  parameterEstimates(
    fit_crude_Enterococcus_3M_bayley_Y1_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                          # none
fit_crude_Enterococcus_3M_bayley_Y1_none_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_none,
      ordered = c("g__Enterococcus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_3M_bayley_Y1_none_bis <-
  parameterEstimates(
    fit_crude_Enterococcus_3M_bayley_Y1_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)                                  # exlusive
fit_crude_Enterococcus_3M_bayley_Y2_exclusive_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_exclusive,
      ordered = c("g__Enterococcus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_3M_bayley_Y2_exclusive_bis <-
  parameterEstimates(
    fit_crude_Enterococcus_3M_bayley_Y2_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                                  # partial
fit_crude_Enterococcus_3M_bayley_Y2_partial_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_partial,
      ordered = c("g__Enterococcus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_3M_bayley_Y2_partial_bis <-
  parameterEstimates(
    fit_crude_Enterococcus_3M_bayley_Y2_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                              # none
fit_crude_Enterococcus_3M_bayley_Y2_none_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_none,
      ordered = c("g__Enterococcus_3M_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_3M_bayley_Y2_none_bis <-
  parameterEstimates(
    fit_crude_Enterococcus_3M_bayley_Y2_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

table_fit_crude_Enterococcus_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Enterococcus_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Enterococcus_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "Enterococcus at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Enterococcus_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Enterococcus_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "Enterococcus at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Enterococcus_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Enterococcus_3M_bayley_Y1_partial_bis, 
              name_predictor = "Enterococcus at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Enterococcus_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Enterococcus_3M_bayley_Y2_partial_bis, 
              name_predictor = "Enterococcus at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Enterococcus_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Enterococcus_3M_bayley_Y1_none_bis, 
              name_predictor = "Enterococcus at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Enterococcus_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Enterococcus_3M_bayley_Y2_none_bis, 
              name_predictor = "Enterococcus at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(C Difficile) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Cdiff_num_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Cdiff_num_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Cdiff_num_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Cdiff_num_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Cdiff_num_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Cdiff_num_3M_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Cdiff_num_3M_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*Cdiff_num_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Cdiff_num_3M_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*Cdiff_num_3M_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Cdiff_num_3M_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Cdiff_num_3M_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Cdiff_num_3M_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Cdiff_num_3M_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Cdiff_num_3M_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Cdiff_num_3M_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Cdiff_num_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Cdiff_num_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Cdiff_num_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "C Difficile at 3 months (num)") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Cdiff_num_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Cdiff_num_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "C Difficile at 3 months (num)") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Cdiff_num_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Cdiff_num_3M_bayley_Y1_partial_bis, 
              name_predictor = "C Difficile at 3 months (num)") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Cdiff_num_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Cdiff_num_3M_bayley_Y2_partial_bis, 
              name_predictor = "C Difficile at 3 months (num)") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Cdiff_num_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Cdiff_num_3M_bayley_Y1_none_bis, 
              name_predictor = "C Difficile at 3 months (num)") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Cdiff_num_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Cdiff_num_3M_bayley_Y2_none_bis, 
              name_predictor = "C Difficile at 3 months (num)") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

```

## C Difficile cat --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_3M,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Cdiff_cat_3M
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*Cdiff_cat_3M
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*Cdiff_cat_3M
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*Cdiff_cat_3M
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)                         # exlusive
fit_crude_Cdiff_cat_3M_bayley_Y1_exclusive_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_exclusive,
      ordered = c("Cdiff_cat_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_3M_bayley_Y1_exclusive_bis <-
  parameterEstimates(
    fit_crude_Cdiff_cat_3M_bayley_Y1_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                            # partial
fit_crude_Cdiff_cat_3M_bayley_Y1_partial_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_partial,
      ordered = c("Cdiff_cat_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_3M_bayley_Y1_partial_bis <-
  parameterEstimates(
    fit_crude_Cdiff_cat_3M_bayley_Y1_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                          # none
fit_crude_Cdiff_cat_3M_bayley_Y1_none_bis <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_none,
      ordered = c("Cdiff_cat_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_3M_bayley_Y1_none_bis <-
  parameterEstimates(
    fit_crude_Cdiff_cat_3M_bayley_Y1_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)                                  # exlusive
fit_crude_Cdiff_cat_3M_bayley_Y2_exclusive_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_exclusive,
      ordered = c("Cdiff_cat_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_3M_bayley_Y2_exclusive_bis <-
  parameterEstimates(
    fit_crude_Cdiff_cat_3M_bayley_Y2_exclusive_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                                  # partial
fit_crude_Cdiff_cat_3M_bayley_Y2_partial_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_partial,
      ordered = c("Cdiff_cat_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_3M_bayley_Y2_partial_bis <-
  parameterEstimates(
    fit_crude_Cdiff_cat_3M_bayley_Y2_partial_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                              # none
fit_crude_Cdiff_cat_3M_bayley_Y2_none_bis <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_none,
      ordered = c("Cdiff_cat_3M", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_3M_bayley_Y2_none_bis <-
  parameterEstimates(
    fit_crude_Cdiff_cat_3M_bayley_Y2_none_bis,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

table_fit_crude_Cdiff_cat_3M_bayley_Y1_strat_bis  <- list(
  table_fit_crude_Cdiff_cat_3M_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_Cdiff_cat_3M_bayley_Y1_exclusive_bis, 
              name_predictor = "C Difficile at 3 months (cat)") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Cdiff_cat_3M_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_Cdiff_cat_3M_bayley_Y2_exclusive_bis, 
              name_predictor = "C Difficile at 3 months (cat)") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Cdiff_cat_3M_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_Cdiff_cat_3M_bayley_Y1_partial_bis, 
              name_predictor = "C Difficile at 3 months (cat)") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Cdiff_cat_3M_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_Cdiff_cat_3M_bayley_Y2_partial_bis, 
              name_predictor = "C Difficile at 3 months (cat)") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Cdiff_cat_3M_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_Cdiff_cat_3M_bayley_Y1_none_bis, 
              name_predictor = "C Difficile at 3 months (cat)") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Cdiff_cat_3M_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_Cdiff_cat_3M_bayley_Y2_none_bis, 
              name_predictor = "C Difficile at 3 months (cat)") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(Acetate) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Acetate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Acetate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Acetate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Acetate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Acetate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Acetate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Acetate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Acetate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Acetate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Acetate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_metabolite_Acetate_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_metabolite_Acetate_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_metabolite_Acetate_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_metabolite_Acetate_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_metabolite_Acetate_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_metabolite_Acetate_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_metabolite_Acetate_bayley_Y1_strat_bis  <- list(
  table_fit_crude_metabolite_Acetate_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Acetate_bayley_Y1_exclusive_bis, 
              name_predictor = "Acetate metabolite at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Acetate_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Acetate_bayley_Y2_exclusive_bis, 
              name_predictor = "Acetate metabolite at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Acetate_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Acetate_bayley_Y1_partial_bis, 
              name_predictor = "Acetate metabolite at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_metabolite_Acetate_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Acetate_bayley_Y2_partial_bis, 
              name_predictor = "Acetate metabolite at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_metabolite_Acetate_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Acetate_bayley_Y1_none_bis, 
              name_predictor = "Acetate metabolite at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_metabolite_Acetate_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Acetate_bayley_Y2_none_bis, 
              name_predictor = "Acetate metabolite at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(Propionate 3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Propionate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Propionate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Propionate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Propionate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Propionate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Propionate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Propionate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Propionate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Propionate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Propionate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_metabolite_Propionate_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_metabolite_Propionate_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_metabolite_Propionate_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_metabolite_Propionate_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_metabolite_Propionate_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_metabolite_Propionate_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_metabolite_Propionate_bayley_Y1_strat_bis  <- list(
  table_fit_crude_metabolite_Propionate_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Propionate_bayley_Y1_exclusive_bis, 
              name_predictor = "metabolite Propionate at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Propionate_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Propionate_bayley_Y2_exclusive_bis, 
              name_predictor = "metabolite Propionate at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Propionate_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Propionate_bayley_Y1_partial_bis, 
              name_predictor = "metabolite Propionate at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_metabolite_Propionate_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Propionate_bayley_Y2_partial_bis, 
              name_predictor = "metabolite Propionate at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_metabolite_Propionate_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Propionate_bayley_Y1_none_bis, 
              name_predictor = "metabolite Propionate at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_metabolite_Propionate_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Propionate_bayley_Y2_none_bis, 
              name_predictor = "metabolite Propionate at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(Butyrate 3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Butyrate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Butyrate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Butyrate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Butyrate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Butyrate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Butyrate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Butyrate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Butyrate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Butyrate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Butyrate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_metabolite_Butyrate_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_metabolite_Butyrate_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_metabolite_Butyrate_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_metabolite_Butyrate_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_metabolite_Butyrate_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_metabolite_Butyrate_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_metabolite_Butyrate_bayley_Y1_strat_bis  <- list(
  table_fit_crude_metabolite_Butyrate_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Butyrate_bayley_Y1_exclusive_bis, 
              name_predictor = "metabolite Butyrate at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Butyrate_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Butyrate_bayley_Y2_exclusive_bis, 
              name_predictor = "metabolite Butyrate at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Butyrate_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Butyrate_bayley_Y1_partial_bis, 
              name_predictor = "metabolite Butyrate at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_metabolite_Butyrate_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Butyrate_bayley_Y2_partial_bis, 
              name_predictor = "metabolite Butyrate at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_metabolite_Butyrate_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Butyrate_bayley_Y1_none_bis, 
              name_predictor = "metabolite Butyrate at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_metabolite_Butyrate_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Butyrate_bayley_Y2_none_bis, 
              name_predictor = "metabolite Butyrate at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```


## ln(Tryptophan) 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Tryptophan_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Tryptophan_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Tryptophan_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Tryptophan_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Tryptophan_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Tryptophan_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Tryptophan_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Tryptophan_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Tryptophan_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Tryptophan_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_metabolite_Tryptophan_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_metabolite_Tryptophan_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_metabolite_Tryptophan_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_metabolite_Tryptophan_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_metabolite_Tryptophan_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_metabolite_Tryptophan_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_metabolite_Tryptophan_bayley_Y1_strat_bis  <- list(
  table_fit_crude_metabolite_Tryptophan_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tryptophan_bayley_Y1_exclusive_bis, 
              name_predictor = "Tryptophan metabolite at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Tryptophan_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tryptophan_bayley_Y2_exclusive_bis, 
              name_predictor = "Tryptophan metabolite at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Tryptophan_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tryptophan_bayley_Y1_partial_bis, 
              name_predictor = "Tryptophan metabolite at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_metabolite_Tryptophan_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tryptophan_bayley_Y2_partial_bis, 
              name_predictor = "Tryptophan metabolite at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_metabolite_Tryptophan_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tryptophan_bayley_Y1_none_bis, 
              name_predictor = "Tryptophan metabolite at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_metabolite_Tryptophan_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tryptophan_bayley_Y2_none_bis, 
              name_predictor = "Tryptophan metabolite at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## Taurine 3M --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Taurine,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Taurine,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Taurine,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Taurine,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Taurine,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Taurine,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Taurine
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Taurine
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Taurine
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Taurine
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_metabolite_Taurine_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_metabolite_Taurine_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_metabolite_Taurine_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_metabolite_Taurine_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_metabolite_Taurine_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_metabolite_Taurine_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_metabolite_Taurine_bayley_Y1_strat_bis  <- list(
  table_fit_crude_metabolite_Taurine_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Taurine_bayley_Y1_exclusive_bis, 
              name_predictor = "metabolite Taurine at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Taurine_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Taurine_bayley_Y2_exclusive_bis, 
              name_predictor = "metabolite Taurine at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Taurine_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Taurine_bayley_Y1_partial_bis, 
              name_predictor = "metabolite Taurine at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_metabolite_Taurine_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Taurine_bayley_Y2_partial_bis, 
              name_predictor = "metabolite Taurine at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_metabolite_Taurine_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Taurine_bayley_Y1_none_bis, 
              name_predictor = "metabolite Taurine at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_metabolite_Taurine_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Taurine_bayley_Y2_none_bis, 
              name_predictor = "metabolite Taurine at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(Lactate 3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Lactate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Lactate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Lactate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Lactate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Lactate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Lactate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Lactate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Lactate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Lactate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Lactate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_metabolite_Lactate_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_metabolite_Lactate_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_metabolite_Lactate_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_metabolite_Lactate_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_metabolite_Lactate_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_metabolite_Lactate_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_metabolite_Lactate_bayley_Y1_strat_bis  <- list(
  table_fit_crude_metabolite_Lactate_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Lactate_bayley_Y1_exclusive_bis, 
              name_predictor = "metabolite Lactate at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Lactate_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Lactate_bayley_Y2_exclusive_bis, 
              name_predictor = "metabolite Lactate at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Lactate_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Lactate_bayley_Y1_partial_bis, 
              name_predictor = "metabolite Lactate at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_metabolite_Lactate_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Lactate_bayley_Y2_partial_bis, 
              name_predictor = "metabolite Lactate at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_metabolite_Lactate_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Lactate_bayley_Y1_none_bis, 
              name_predictor = "metabolite Lactate at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_metabolite_Lactate_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Lactate_bayley_Y2_none_bis, 
              name_predictor = "metabolite Lactate at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(Formate 3M) --> sIgA 3M --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Formate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Formate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Formate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Formate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Formate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Formate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Formate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Formate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Formate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Formate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_metabolite_Formate_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_metabolite_Formate_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_metabolite_Formate_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_metabolite_Formate_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_metabolite_Formate_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_metabolite_Formate_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_metabolite_Formate_bayley_Y1_strat_bis  <- list(
  table_fit_crude_metabolite_Formate_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Formate_bayley_Y1_exclusive_bis, 
              name_predictor = "metabolite Formate at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Formate_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Formate_bayley_Y2_exclusive_bis, 
              name_predictor = "metabolite Formate at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Formate_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Formate_bayley_Y1_partial_bis, 
              name_predictor = "metabolite Formate at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_metabolite_Formate_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Formate_bayley_Y2_partial_bis, 
              name_predictor = "metabolite Formate at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_metabolite_Formate_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Formate_bayley_Y1_none_bis, 
              name_predictor = "metabolite Formate at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_metabolite_Formate_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Formate_bayley_Y2_none_bis, 
              name_predictor = "metabolite Formate at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))

```

## ln(Tyrosine) 3M --> sIgA 3M --> Bayley 
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Tyrosine_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Tyrosine_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Tyrosine_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Tyrosine_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Tyrosine_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Tyrosine_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Tyrosine_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Tyrosine_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Tyrosine_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Tyrosine_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_metabolite_Tyrosine_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_metabolite_Tyrosine_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_metabolite_Tyrosine_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_metabolite_Tyrosine_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_metabolite_Tyrosine_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_metabolite_Tyrosine_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_metabolite_Tyrosine_bayley_Y1_strat_bis  <- list(
  table_fit_crude_metabolite_Tyrosine_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tyrosine_bayley_Y1_exclusive_bis, 
              name_predictor = "metabolite Tyrosine at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Tyrosine_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tyrosine_bayley_Y2_exclusive_bis, 
              name_predictor = "metabolite Tyrosine at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Tyrosine_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tyrosine_bayley_Y1_partial_bis, 
              name_predictor = "metabolite Tyrosine at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_metabolite_Tyrosine_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tyrosine_bayley_Y2_partial_bis, 
              name_predictor = "metabolite Tyrosine at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_metabolite_Tyrosine_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tyrosine_bayley_Y1_none_bis, 
              name_predictor = "metabolite Tyrosine at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_metabolite_Tyrosine_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Tyrosine_bayley_Y2_none_bis, 
              name_predictor = "metabolite Tyrosine at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## ln(Valerate) 3M --> sIgA 3M --> Bayley 
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Valerate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Valerate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Valerate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Valerate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         metabolite_Valerate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         metabolite_Valerate_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Valerate_ln
BAYLEYQ4_3_12 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Valerate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
sIgA_3m_cat_CutOff5 ~ a*metabolite_Valerate_ln
BAYLEYQ4_3_24 ~ b*sIgA_3m_cat_CutOff5 + c*metabolite_Valerate_ln
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_metabolite_Valerate_bayley_Y1_exclusive_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_metabolite_Valerate_bayley_Y2_exclusive_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_metabolite_Valerate_bayley_Y1_partial_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_metabolite_Valerate_bayley_Y2_partial_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_metabolite_Valerate_bayley_Y1_none_bis <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_metabolite_Valerate_bayley_Y2_none_bis <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_metabolite_Valerate_bayley_Y1_strat_bis  <- list(
  table_fit_crude_metabolite_Valerate_bayley_Y1_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Valerate_bayley_Y1_exclusive_bis, 
              name_predictor = "metabolite Valerate at 3 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Valerate_bayley_Y2_exclusive_bis =
    nettoyage(fit = table_fit_crude_metabolite_Valerate_bayley_Y2_exclusive_bis, 
              name_predictor = "metabolite Valerate at 3 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_metabolite_Valerate_bayley_Y1_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Valerate_bayley_Y1_partial_bis, 
              name_predictor = "metabolite Valerate at 3 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_metabolite_Valerate_bayley_Y2_partial_bis =
    nettoyage(fit = table_fit_crude_metabolite_Valerate_bayley_Y2_partial_bis, 
              name_predictor = "metabolite Valerate at 3 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_metabolite_Valerate_bayley_Y1_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Valerate_bayley_Y1_none_bis, 
              name_predictor = "metabolite Valerate at 3 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_metabolite_Valerate_bayley_Y2_none_bis =
    nettoyage(fit = table_fit_crude_metabolite_Valerate_bayley_Y2_none_bis, 
              name_predictor = "metabolite Valerate at 3 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

```{r}
rm(mediation, nettoyage)
```

# Tables S4 and S5
Relation between sIgA level at 3 months and Bayley cognitive scores at 12 and 24 months, mediated by gut microbiota at 12 months, stratified by breastfeeding status at 3 months.
## Fonctions
```{r}
nettoyage <- function(fit, name_mediator) {
  table <- 
    bind_rows(
      c(Mediator = {name_mediator}, 
        Predictor = "sIgA at 3 months"), 
      fit) %>%
    filter(op %in% c("~", ":=", NA)) %>%
    mutate(
      est = round(est, digits = 2),
      ci.lower = round(ci.lower, digits = 1), 
      ci.upper = round(ci.upper, digits = 1), 
      pvalue = round(pvalue, digits = 3),
      CI = paste(ci.lower, ci.upper, sep = ", "), 
      label = fct_recode(label, "c'" = "c", "total: c' + (a*b)" = "total")) %>%
    select(
      Predictor, 
      Mediator,
      Path = label, 
      est, 
      CI,
      pvalue) 
  return(table)
}

mediation <- function(model, data) {
  set.seed(1000)
  fit <- 
    sem(model, 
        data = data,
        ordered = "sIgA_3m_cat_CutOff5",
        se = "bootstrap", 
        bootstrap = 5000, 
        estimator = "DWLS")
  fit <- parameterEstimates(fit, ci = TRUE, level = 0.95, boot.ci.type = "perc")
  return(fit)
}
```

## sIgA 3M --> Clusters 12M --> Bayley
```{r sIgA 3M --> Clusters 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Clusters_Hein_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
Clusters_Hein_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*Clusters_Hein_Y1 + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
Clusters_Hein_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*Clusters_Hein_Y1 + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)                         # exlusive
fit_crude_Clusters_Y1_bayley_Y1_exclusive <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_exclusive,
      ordered = c("Clusters_Hein_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Y1_bayley_Y1_exclusive <-
  parameterEstimates(
    fit_crude_Clusters_Y1_bayley_Y1_exclusive,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                            # partial
fit_crude_Clusters_Y1_bayley_Y1_partial <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_partial,
      ordered = c("Clusters_Hein_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Y1_bayley_Y1_partial <-
  parameterEstimates(
    fit_crude_Clusters_Y1_bayley_Y1_partial,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                          # none
fit_crude_Clusters_Y1_bayley_Y1_none <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_none,
      ordered = c("Clusters_Hein_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Y1_bayley_Y1_none <-
  parameterEstimates(
    fit_crude_Clusters_Y1_bayley_Y1_none,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)                                  # exlusive
fit_crude_Clusters_Y1_bayley_Y2_exclusive <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_exclusive,
      ordered = c("Clusters_Hein_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Y1_bayley_Y2_exclusive <-
  parameterEstimates(
    fit_crude_Clusters_Y1_bayley_Y2_exclusive,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                                  # partial
fit_crude_Clusters_Y1_bayley_Y2_partial <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_partial,
      ordered = c("Clusters_Hein_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Y1_bayley_Y2_partial <-
  parameterEstimates(
    fit_crude_Clusters_Y1_bayley_Y2_partial,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                              # none
fit_crude_Clusters_Y1_bayley_Y2_none <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_none,
      ordered = c("Clusters_Hein_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Clusters_Y1_bayley_Y2_none <-
  parameterEstimates(
    fit_crude_Clusters_Y1_bayley_Y2_none,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

table_fit_crude_Clusters_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Clusters_Y1_bayley_Y1_exclusive =
    nettoyage(fit = table_fit_crude_Clusters_Y1_bayley_Y1_exclusive, name_mediator = "Clusters at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Clusters_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Clusters_Y1_bayley_Y2_exclusive, name_mediator = "Clusters at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Clusters_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Clusters_Y1_bayley_Y1_partial, name_mediator = "Clusters at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Clusters_Y1_bayley_Y2_partial =
    nettoyage(fit = table_fit_crude_Clusters_Y1_bayley_Y2_partial, name_mediator = "Clusters at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Clusters_Y1_bayley_Y1_none =
    nettoyage(fit = table_fit_crude_Clusters_Y1_bayley_Y1_none, name_mediator = "Clusters at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Clusters_Y1_bayley_Y2_none =
    nettoyage(fit = table_fit_crude_Clusters_Y1_bayley_Y2_none, name_mediator = "Clusters at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> Proteobacteria 12M --> Bayley
```{r sIgA 3M --> Proteobacteria 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Proteobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Proteobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Proteobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Proteobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Proteobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Proteobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
p__Proteobacteria_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*p__Proteobacteria_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
p__Proteobacteria_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*p__Proteobacteria_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Proteobacteria_Y1_bayley_Y1_exclusive <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Proteobacteria_Y1_bayley_Y2_exclusive <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Proteobacteria_Y1_bayley_Y1_partial <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Proteobacteria_Y1_bayley_Y2_partial <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Proteobacteria_Y1_bayley_Y1_none <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Proteobacteria_Y1_bayley_Y2_none <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Proteobacteria_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Proteobacteria_Y1_bayley_Y1_exclusive = 
    nettoyage(fit = table_fit_crude_Proteobacteria_Y1_bayley_Y1_exclusive, name_mediator = "Proteobacteria at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Proteobacteria_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Proteobacteria_Y1_bayley_Y2_exclusive, name_mediator = "Proteobacteria at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Proteobacteria_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Proteobacteria_Y1_bayley_Y1_partial, name_mediator = "Proteobacteria at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Proteobacteria_Y1_bayley_Y2_partial = 
    nettoyage(fit = table_fit_crude_Proteobacteria_Y1_bayley_Y2_partial, name_mediator = "Proteobacteria at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Proteobacteria_Y1_bayley_Y1_none = 
    nettoyage(fit = table_fit_crude_Proteobacteria_Y1_bayley_Y1_none, name_mediator = "Proteobacteria at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Proteobacteria_Y1_bayley_Y2_none = 
    nettoyage(fit = table_fit_crude_Proteobacteria_Y1_bayley_Y2_none, name_mediator = "Proteobacteria at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> Firmicutes 12M --> Bayley
```{r sIgA 3M --> Firmicutes 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Firmicutes_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Firmicutes_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Firmicutes_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Firmicutes_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Firmicutes_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Firmicutes_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
p__Firmicutes_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*p__Firmicutes_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
p__Firmicutes_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*p__Firmicutes_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Firmicutes_Y1_bayley_Y1_exclusive <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Firmicutes_Y1_bayley_Y2_exclusive <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Firmicutes_Y1_bayley_Y1_partial <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Firmicutes_Y1_bayley_Y2_partial <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Firmicutes_Y1_bayley_Y1_none <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Firmicutes_Y1_bayley_Y2_none <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Firmicutes_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Firmicutes_Y1_bayley_Y1_exclusive = 
    nettoyage(fit = table_fit_crude_Firmicutes_Y1_bayley_Y1_exclusive, name_mediator = "Firmicutes at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Firmicutes_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Firmicutes_Y1_bayley_Y2_exclusive, name_mediator = "Firmicutes at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Firmicutes_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Firmicutes_Y1_bayley_Y1_partial, name_mediator = "Firmicutes at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Firmicutes_Y1_bayley_Y2_partial = 
    nettoyage(fit = table_fit_crude_Firmicutes_Y1_bayley_Y2_partial, name_mediator = "Firmicutes at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Firmicutes_Y1_bayley_Y1_none = 
    nettoyage(fit = table_fit_crude_Firmicutes_Y1_bayley_Y1_none, name_mediator = "Firmicutes at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Firmicutes_Y1_bayley_Y2_none = 
    nettoyage(fit = table_fit_crude_Firmicutes_Y1_bayley_Y2_none, name_mediator = "Firmicutes at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> Bacteroidetes 12M --> Bayley
```{r sIgA 3M --> Bacteroidetes 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_Y1_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_Y1_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_Y1_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_Y1_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_Y1_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         p__Bacteroidetes_Y1_cat3,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
p__Bacteroidetes_Y1_cat3 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*p__Bacteroidetes_Y1_cat3 + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
p__Bacteroidetes_Y1_cat3 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*p__Bacteroidetes_Y1_cat3 + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)                         # exlusive
fit_crude_Bacteroidetes_Y1_bayley_Y1_exclusive <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_exclusive,
      ordered = c("p__Bacteroidetes_Y1_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_Y1_bayley_Y1_exclusive <-
  parameterEstimates(
    fit_crude_Bacteroidetes_Y1_bayley_Y1_exclusive,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                            # partial
fit_crude_Bacteroidetes_Y1_bayley_Y1_partial <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_partial,
      ordered = c("p__Bacteroidetes_Y1_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_Y1_bayley_Y1_partial <-
  parameterEstimates(
    fit_crude_Bacteroidetes_Y1_bayley_Y1_partial,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                          # none
fit_crude_Bacteroidetes_Y1_bayley_Y1_none <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_none,
      ordered = c("p__Bacteroidetes_Y1_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_Y1_bayley_Y1_none <-
  parameterEstimates(
    fit_crude_Bacteroidetes_Y1_bayley_Y1_none,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)                                  # exlusive
fit_crude_Bacteroidetes_Y1_bayley_Y2_exclusive <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_exclusive,
      ordered = c("p__Bacteroidetes_Y1_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_Y1_bayley_Y2_exclusive <-
  parameterEstimates(
    fit_crude_Bacteroidetes_Y1_bayley_Y2_exclusive,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                                  # partial
fit_crude_Bacteroidetes_Y1_bayley_Y2_partial <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_partial,
      ordered = c("p__Bacteroidetes_Y1_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_Y1_bayley_Y2_partial <-
  parameterEstimates(
    fit_crude_Bacteroidetes_Y1_bayley_Y2_partial,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                              # none
fit_crude_Bacteroidetes_Y1_bayley_Y2_none <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_none,
      ordered = c("p__Bacteroidetes_Y1_cat3", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Bacteroidetes_Y1_bayley_Y2_none <-
  parameterEstimates(
    fit_crude_Bacteroidetes_Y1_bayley_Y2_none,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

table_fit_crude_Bacteroidetes_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Bacteroidetes_Y1_bayley_Y1_exclusive =
    nettoyage(fit = table_fit_crude_Bacteroidetes_Y1_bayley_Y1_exclusive, name_mediator = "Bacteroidetes at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Bacteroidetes_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Bacteroidetes_Y1_bayley_Y2_exclusive, name_mediator = "Bacteroidetes at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Bacteroidetes_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Bacteroidetes_Y1_bayley_Y1_partial, name_mediator = "Bacteroidetes at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Bacteroidetes_Y1_bayley_Y2_partial =
    nettoyage(fit = table_fit_crude_Bacteroidetes_Y1_bayley_Y2_partial, name_mediator = "Bacteroidetes at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Bacteroidetes_Y1_bayley_Y1_none =
    nettoyage(fit = table_fit_crude_Bacteroidetes_Y1_bayley_Y1_none, name_mediator = "Bacteroidetes at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Bacteroidetes_Y1_bayley_Y2_none =
    nettoyage(fit = table_fit_crude_Bacteroidetes_Y1_bayley_Y2_none, name_mediator = "Bacteroidetes at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> Actinobacteria 12M --> Bayley
```{r sIgA 3M --> Actinobacteria 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Actinobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Actinobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Actinobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Actinobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         p__Actinobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         p__Actinobacteria_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
p__Actinobacteria_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*p__Actinobacteria_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
p__Actinobacteria_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*p__Actinobacteria_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Actinobacteria_Y1_bayley_Y1_exclusive <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Actinobacteria_Y1_bayley_Y2_exclusive <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Actinobacteria_Y1_bayley_Y1_partial <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Actinobacteria_Y1_bayley_Y2_partial <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Actinobacteria_Y1_bayley_Y1_none <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Actinobacteria_Y1_bayley_Y2_none <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Actinobacteria_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Actinobacteria_Y1_bayley_Y1_exclusive = 
    nettoyage(fit = table_fit_crude_Actinobacteria_Y1_bayley_Y1_exclusive, name_mediator = "Actinobacteria at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Actinobacteria_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Actinobacteria_Y1_bayley_Y2_exclusive, name_mediator = "Actinobacteria at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Actinobacteria_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Actinobacteria_Y1_bayley_Y1_partial, name_mediator = "Actinobacteria at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Actinobacteria_Y1_bayley_Y2_partial = 
    nettoyage(fit = table_fit_crude_Actinobacteria_Y1_bayley_Y2_partial, name_mediator = "Actinobacteria at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Actinobacteria_Y1_bayley_Y1_none = 
    nettoyage(fit = table_fit_crude_Actinobacteria_Y1_bayley_Y1_none, name_mediator = "Actinobacteria at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Actinobacteria_Y1_bayley_Y2_none = 
    nettoyage(fit = table_fit_crude_Actinobacteria_Y1_bayley_Y2_none, name_mediator = "Actinobacteria at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> C Difficile num 12M --> Bayley
```{r sIgA 3M --> C Difficile num 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_num_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_num_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_num_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_num_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_12, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_num_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>% 
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident, 
         BAYLEYQ4_3_24, 
         sIgA_3m_cat_CutOff5, 
         Cdiff_num_Y1_ln, 
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
Cdiff_num_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*Cdiff_num_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
Cdiff_num_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*Cdiff_num_Y1_ln + c*sIgA_3m_cat_CutOff5 
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Cdiff_num_Y1_bayley_Y1_exclusive <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Cdiff_num_Y1_bayley_Y2_exclusive <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Cdiff_num_Y1_bayley_Y1_partial <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Cdiff_num_Y1_bayley_Y2_partial <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Cdiff_num_Y1_bayley_Y1_none <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Cdiff_num_Y1_bayley_Y2_none <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Cdiff_num_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Cdiff_num_Y1_bayley_Y1_exclusive = 
    nettoyage(fit = table_fit_crude_Cdiff_num_Y1_bayley_Y1_exclusive, name_mediator = "C difficile (num) at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Cdiff_num_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Cdiff_num_Y1_bayley_Y2_exclusive, name_mediator = "C difficile (num) at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Cdiff_num_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Cdiff_num_Y1_bayley_Y1_partial, name_mediator = "C difficile (num) at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Cdiff_num_Y1_bayley_Y2_partial = 
    nettoyage(fit = table_fit_crude_Cdiff_num_Y1_bayley_Y2_partial, name_mediator = "C difficile (num) at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Cdiff_num_Y1_bayley_Y1_none = 
    nettoyage(fit = table_fit_crude_Cdiff_num_Y1_bayley_Y1_none, name_mediator = "C difficile (num) at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Cdiff_num_Y1_bayley_Y2_none = 
    nettoyage(fit = table_fit_crude_Cdiff_num_Y1_bayley_Y2_none, name_mediator = "C difficile (num) at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> C Difficile cat 12M --> Bayley
```{r sIgA 3M --> C Difficile cat 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         Cdiff_cat_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
Cdiff_cat_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*Cdiff_cat_Y1 + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
Cdiff_cat_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*Cdiff_cat_Y1 + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)                         # exlusive
fit_crude_Cdiff_cat_Y1_bayley_Y1_exclusive <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_exclusive,
      ordered = c("Cdiff_cat_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_Y1_bayley_Y1_exclusive <-
  parameterEstimates(
    fit_crude_Cdiff_cat_Y1_bayley_Y1_exclusive,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                            # partial
fit_crude_Cdiff_cat_Y1_bayley_Y1_partial <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_partial,
      ordered = c("Cdiff_cat_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_Y1_bayley_Y1_partial <-
  parameterEstimates(
    fit_crude_Cdiff_cat_Y1_bayley_Y1_partial,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                          # none
fit_crude_Cdiff_cat_Y1_bayley_Y1_none <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_none,
      ordered = c("Cdiff_cat_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_Y1_bayley_Y1_none <-
  parameterEstimates(
    fit_crude_Cdiff_cat_Y1_bayley_Y1_none,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)                                  # exlusive
fit_crude_Cdiff_cat_Y1_bayley_Y2_exclusive <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_exclusive,
      ordered = c("Cdiff_cat_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_Y1_bayley_Y2_exclusive <-
  parameterEstimates(
    fit_crude_Cdiff_cat_Y1_bayley_Y2_exclusive,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                                  # partial
fit_crude_Cdiff_cat_Y1_bayley_Y2_partial <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_partial,
      ordered = c("Cdiff_cat_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_Y1_bayley_Y2_partial <-
  parameterEstimates(
    fit_crude_Cdiff_cat_Y1_bayley_Y2_partial,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                              # none
fit_crude_Cdiff_cat_Y1_bayley_Y2_none <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_none,
      ordered = c("Cdiff_cat_Y1", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Cdiff_cat_Y1_bayley_Y2_none <-
  parameterEstimates(
    fit_crude_Cdiff_cat_Y1_bayley_Y2_none,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

table_fit_crude_Cdiff_cat_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Cdiff_cat_Y1_bayley_Y1_exclusive =
    nettoyage(fit = table_fit_crude_Cdiff_cat_Y1_bayley_Y1_exclusive, name_mediator = "C difficile (cat) at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Cdiff_cat_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Cdiff_cat_Y1_bayley_Y2_exclusive, name_mediator = "C difficile (cat) at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Cdiff_cat_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Cdiff_cat_Y1_bayley_Y1_partial, name_mediator = "C difficile (cat) at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Cdiff_cat_Y1_bayley_Y2_partial =
    nettoyage(fit = table_fit_crude_Cdiff_cat_Y1_bayley_Y2_partial, name_mediator = "C difficile (cat) at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Cdiff_cat_Y1_bayley_Y1_none =
    nettoyage(fit = table_fit_crude_Cdiff_cat_Y1_bayley_Y1_none, name_mediator = "C difficile (cat) at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Cdiff_cat_Y1_bayley_Y2_none =
    nettoyage(fit = table_fit_crude_Cdiff_cat_Y1_bayley_Y2_none, name_mediator = "C difficile (cat) at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> Bacteroides 12M --> Bayley
```{r message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bacteroides_Y1,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
g__Bacteroides_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Bacteroides_Y1 + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Bacteroides_Y1 ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Bacteroides_Y1 + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Bacteroides_Y1_bayley_Y1_exclusive <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Bacteroides_Y1_bayley_Y2_exclusive <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Bacteroides_Y1_bayley_Y1_partial <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Bacteroides_Y1_bayley_Y2_partial <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Bacteroides_Y1_bayley_Y1_none <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Bacteroides_Y1_bayley_Y2_none <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Bacteroides_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Bacteroides_Y1_bayley_Y1_exclusive =
    nettoyage(fit = table_fit_crude_Bacteroides_Y1_bayley_Y1_exclusive, name_mediator = "Bacteroides at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Bacteroides_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Bacteroides_Y1_bayley_Y2_exclusive, name_mediator = "Bacteroides at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Bacteroides_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Bacteroides_Y1_bayley_Y1_partial, name_mediator = "Bacteroides at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Bacteroides_Y1_bayley_Y2_partial =
    nettoyage(fit = table_fit_crude_Bacteroides_Y1_bayley_Y2_partial, name_mediator = "Bacteroides at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Bacteroides_Y1_bayley_Y1_none =
    nettoyage(fit = table_fit_crude_Bacteroides_Y1_bayley_Y1_none, name_mediator = "Bacteroides at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Bacteroides_Y1_bayley_Y2_none =
    nettoyage(fit = table_fit_crude_Bacteroides_Y1_bayley_Y2_none, name_mediator = "Bacteroides at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> Lachnospiraceae_g__ ln 12M --> Bayley
```{r sIgA 3M --> Lachnospiraceae_g__ 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         f__Lachnospiraceae_g___Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")%>%
  filter(!f__Lachnospiraceae_g___Y1_ln == "-Inf")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         f__Lachnospiraceae_g___Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")%>%
  filter(!f__Lachnospiraceae_g___Y1_ln == "-Inf")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         f__Lachnospiraceae_g___Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!f__Lachnospiraceae_g___Y1_ln == "-Inf")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         f__Lachnospiraceae_g___Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!f__Lachnospiraceae_g___Y1_ln == "-Inf")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         f__Lachnospiraceae_g___Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!f__Lachnospiraceae_g___Y1_ln == "-Inf")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         f__Lachnospiraceae_g___Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!f__Lachnospiraceae_g___Y1_ln == "-Inf")

model_crude_Y1 <- '# simple mediation
f__Lachnospiraceae_g___Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*f__Lachnospiraceae_g___Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
f__Lachnospiraceae_g___Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*f__Lachnospiraceae_g___Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_exclusive <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y2_exclusive <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_partial <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y2_partial <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_none <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y2_none <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_exclusive =
    nettoyage(fit = table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_exclusive, name_mediator = "Lachnospiraceae_g at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y2_exclusive, name_mediator = "Lachnospiraceae_g at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_partial, name_mediator = "Lachnospiraceae_g at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y2_partial =
    nettoyage(fit = table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y2_partial, name_mediator = "Lachnospiraceae_g at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_none =
    nettoyage(fit = table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_none, name_mediator = "Lachnospiraceae_g at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y2_none =
    nettoyage(fit = table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y2_none, name_mediator = "Lachnospiraceae_g at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> Bifidobacterium ln 12M --> Bayley
```{r sIgA 3M --> Bifidobacterium ln 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")%>%
  filter(!g__Bifidobacterium_Y1_ln == "-Inf")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")%>%
  filter(!g__Bifidobacterium_Y1_ln == "-Inf")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!g__Bifidobacterium_Y1_ln == "-Inf")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!g__Bifidobacterium_Y1_ln == "-Inf")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!g__Bifidobacterium_Y1_ln == "-Inf")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Bifidobacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!g__Bifidobacterium_Y1_ln == "-Inf")

model_crude_Y1 <- '# simple mediation
g__Bifidobacterium_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Bifidobacterium_Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Bifidobacterium_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Bifidobacterium_Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Bifidobacterium_Y1_bayley_Y1_exclusive <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Bifidobacterium_Y1_bayley_Y2_exclusive <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Bifidobacterium_Y1_bayley_Y1_partial <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Bifidobacterium_Y1_bayley_Y2_partial <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Bifidobacterium_Y1_bayley_Y1_none <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Bifidobacterium_Y1_bayley_Y2_none <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Bifidobacterium_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Bifidobacterium_Y1_bayley_Y1_exclusive =
    nettoyage(fit = table_fit_crude_Bifidobacterium_Y1_bayley_Y1_exclusive, name_mediator = "Bifidobacterium at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Bifidobacterium_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Bifidobacterium_Y1_bayley_Y2_exclusive, name_mediator = "Bifidobacterium at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Bifidobacterium_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Bifidobacterium_Y1_bayley_Y1_partial, name_mediator = "Bifidobacterium at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Bifidobacterium_Y1_bayley_Y2_partial =
    nettoyage(fit = table_fit_crude_Bifidobacterium_Y1_bayley_Y2_partial, name_mediator = "Bifidobacterium at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Bifidobacterium_Y1_bayley_Y1_none =
    nettoyage(fit = table_fit_crude_Bifidobacterium_Y1_bayley_Y1_none, name_mediator = "Bifidobacterium at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Bifidobacterium_Y1_bayley_Y2_none =
    nettoyage(fit = table_fit_crude_Bifidobacterium_Y1_bayley_Y2_none, name_mediator = "Bifidobacterium at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> Veillonella ln 12M --> Bayley
```{r sIgA 3M --> Veillonella ln 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Veillonella_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
g__Veillonella_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Veillonella_Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Veillonella_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Veillonella_Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Veillonella_Y1_bayley_Y1_exclusive <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Veillonella_Y1_bayley_Y2_exclusive <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Veillonella_Y1_bayley_Y1_partial <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Veillonella_Y1_bayley_Y2_partial <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Veillonella_Y1_bayley_Y1_none <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Veillonella_Y1_bayley_Y2_none <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Veillonella_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Veillonella_Y1_bayley_Y1_exclusive =
    nettoyage(fit = table_fit_crude_Veillonella_Y1_bayley_Y1_exclusive, name_mediator = "Veillonella at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Veillonella_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Veillonella_Y1_bayley_Y2_exclusive, name_mediator = "Veillonella at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Veillonella_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Veillonella_Y1_bayley_Y1_partial, name_mediator = "Veillonella at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Veillonella_Y1_bayley_Y2_partial =
    nettoyage(fit = table_fit_crude_Veillonella_Y1_bayley_Y2_partial, name_mediator = "Veillonella at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Veillonella_Y1_bayley_Y1_none =
    nettoyage(fit = table_fit_crude_Veillonella_Y1_bayley_Y1_none, name_mediator = "Veillonella at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Veillonella_Y1_bayley_Y2_none =
    nettoyage(fit = table_fit_crude_Veillonella_Y1_bayley_Y2_none, name_mediator = "Veillonella at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> Faecalibacterium ln 12M --> Bayley
```{r sIgA 3M --> Faecalibacterium ln 12M --> Bayley, message=FALSE, warning=FALSE}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Faecalibacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")%>%
  filter(!g__Faecalibacterium_Y1_ln == "-Inf")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Faecalibacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")%>%
  filter(!g__Faecalibacterium_Y1_ln == "-Inf")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Faecalibacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!g__Faecalibacterium_Y1_ln == "-Inf")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Faecalibacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!g__Faecalibacterium_Y1_ln == "-Inf")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Faecalibacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!g__Faecalibacterium_Y1_ln == "-Inf")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Faecalibacterium_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!g__Faecalibacterium_Y1_ln == "-Inf")

model_crude_Y1 <- '# simple mediation
g__Faecalibacterium_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Faecalibacterium_Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Faecalibacterium_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Faecalibacterium_Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Faecalibacterium_Y1_bayley_Y1_exclusive <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Faecalibacterium_Y1_bayley_Y2_exclusive <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Faecalibacterium_Y1_bayley_Y1_partial <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Faecalibacterium_Y1_bayley_Y2_partial <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Faecalibacterium_Y1_bayley_Y1_none <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Faecalibacterium_Y1_bayley_Y2_none <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Faecalibacterium_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Faecalibacterium_Y1_bayley_Y1_exclusive =
    nettoyage(fit = table_fit_crude_Faecalibacterium_Y1_bayley_Y1_exclusive,
              name_mediator = "Faecalibacterium at 12 months") %>%
    rename(
      "Est Y1 exclusive" = est,
      "CI Y1 exclusive" = CI,
      "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Faecalibacterium_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Faecalibacterium_Y1_bayley_Y2_exclusive, 
              name_mediator = "Faecalibacterium at 12 months") %>%
    rename(
      "Est Y2 exclusive" = est,
      "CI Y2 exclusive" = CI,
      "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Faecalibacterium_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Faecalibacterium_Y1_bayley_Y1_partial, 
              name_mediator = "Faecalibacterium at 12 months") %>%
    rename(
      "Est Y1 partial" = est,
      "CI Y1 partial" = CI,
      "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Faecalibacterium_Y1_bayley_Y2_partial =
    nettoyage(fit = table_fit_crude_Faecalibacterium_Y1_bayley_Y2_partial, 
              name_mediator = "Faecalibacterium at 12 months") %>%
    rename(
      "Est Y2 partial" = est,
      "CI Y2 partial" = CI,
      "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Faecalibacterium_Y1_bayley_Y1_none =
    nettoyage(fit = table_fit_crude_Faecalibacterium_Y1_bayley_Y1_none, 
              name_mediator = "Faecalibacterium at 12 months") %>%
    rename(
      "Est Y1 none" = est,
      "CI Y1 none" = CI,
      "p-value Y1 none" = pvalue),
  
  table_fit_crude_Faecalibacterium_Y1_bayley_Y2_none =
    nettoyage(fit = table_fit_crude_Faecalibacterium_Y1_bayley_Y2_none, 
              name_mediator = "Faecalibacterium at 12 months") %>%
    rename(
      "Est Y2 none" = est,
      "CI Y2 none" = CI,
      "p-value Y2 none" = pvalue)) %>%
  
  reduce( ~ left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```


## sIgA 3M --> ln(Streptococcus_Y1) --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")%>%
  filter(!g__Streptococcus_Y1_ln =="-Inf")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")%>%
  filter(!g__Streptococcus_Y1_ln =="-Inf")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!g__Streptococcus_Y1_ln =="-Inf")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")%>%
  filter(!g__Streptococcus_Y1_ln =="-Inf")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!g__Streptococcus_Y1_ln =="-Inf")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Streptococcus_Y1_ln,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")%>%
  filter(!g__Streptococcus_Y1_ln =="-Inf")

model_crude_Y1 <- '# simple mediation
g__Streptococcus_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Streptococcus_Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Streptococcus_Y1_ln ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Streptococcus_Y1_ln + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

table_fit_crude_Streptococcus_Y1_bayley_Y1_exclusive <- mediation(model = model_crude_Y1, data = bdd_final_Y1_exclusive)
table_fit_crude_Streptococcus_Y1_bayley_Y2_exclusive <- mediation(model = model_crude_Y2, data = bdd_final_Y2_exclusive)
table_fit_crude_Streptococcus_Y1_bayley_Y1_partial <- mediation(model = model_crude_Y1, data = bdd_final_Y1_partial)
table_fit_crude_Streptococcus_Y1_bayley_Y2_partial <- mediation(model = model_crude_Y2, data = bdd_final_Y2_partial)
table_fit_crude_Streptococcus_Y1_bayley_Y1_none <- mediation(model = model_crude_Y1, data = bdd_final_Y1_none)
table_fit_crude_Streptococcus_Y1_bayley_Y2_none <- mediation(model = model_crude_Y2, data = bdd_final_Y2_none)

table_fit_crude_Streptococcus_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Streptococcus_Y1_bayley_Y1_exclusive =
    nettoyage(fit = table_fit_crude_Streptococcus_Y1_bayley_Y1_exclusive, name_mediator = "Streptococcus at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Streptococcus_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Streptococcus_Y1_bayley_Y2_exclusive, name_mediator = "Streptococcus at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Streptococcus_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Streptococcus_Y1_bayley_Y1_partial, name_mediator = "Streptococcus at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Streptococcus_Y1_bayley_Y2_partial =
    nettoyage(fit = table_fit_crude_Streptococcus_Y1_bayley_Y2_partial, name_mediator = "Streptococcus at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Streptococcus_Y1_bayley_Y1_none =
    nettoyage(fit = table_fit_crude_Streptococcus_Y1_bayley_Y1_none, name_mediator = "Streptococcus at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Streptococcus_Y1_bayley_Y2_none =
    nettoyage(fit = table_fit_crude_Streptococcus_Y1_bayley_Y2_none, name_mediator = "Streptococcus at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> Lactobacillus Y1 cat --> Bayley
```{r}
bdd_final_Y1_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_Y1_cat, g__Enterococcus_Y1_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y2_exclusive <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_Y1_cat, g__Enterococcus_Y1_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Exclusive")

bdd_final_Y1_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_Y1_cat, g__Enterococcus_Y1_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y2_partial <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_Y1_cat, g__Enterococcus_Y1_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "Partial")

bdd_final_Y1_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_12,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_Y1_cat, g__Enterococcus_Y1_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

bdd_final_Y2_none <- bdd %>%
  select(ident,
         BAYLEYQ4_3_24,
         sIgA_3m_cat_CutOff5,
         g__Lactobacillus_Y1_cat, g__Enterococcus_Y1_cat,
         Sex, GA, Birthmode_2cat, BFStatus3m) %>%
  na.omit() %>%
  filter(BFStatus3m == "None")

model_crude_Y1 <- '# simple mediation
g__Lactobacillus_Y1_cat ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Lactobacillus_Y1_cat + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Lactobacillus_Y1_cat ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Lactobacillus_Y1_cat + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'


# Crude model, Bayley 1Y
set.seed(1000)                         # exlusive
fit_crude_Lactobacillus_Y1_bayley_Y1_exclusive <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_exclusive,
      ordered = c("g__Lactobacillus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_Y1_bayley_Y1_exclusive <-
  parameterEstimates(
    fit_crude_Lactobacillus_Y1_bayley_Y1_exclusive,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                            # partial
fit_crude_Lactobacillus_Y1_bayley_Y1_partial <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_partial,
      ordered = c("g__Lactobacillus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_Y1_bayley_Y1_partial <-
  parameterEstimates(
    fit_crude_Lactobacillus_Y1_bayley_Y1_partial,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                          # none
fit_crude_Lactobacillus_Y1_bayley_Y1_none <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_none,
      ordered = c("g__Lactobacillus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_Y1_bayley_Y1_none <-
  parameterEstimates(
    fit_crude_Lactobacillus_Y1_bayley_Y1_none,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)                                  # exlusive
fit_crude_Lactobacillus_Y1_bayley_Y2_exclusive <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_exclusive,
      ordered = c("g__Lactobacillus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_Y1_bayley_Y2_exclusive <-
  parameterEstimates(
    fit_crude_Lactobacillus_Y1_bayley_Y2_exclusive,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                                  # partial
fit_crude_Lactobacillus_Y1_bayley_Y2_partial <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_partial,
      ordered = c("g__Lactobacillus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_Y1_bayley_Y2_partial <-
  parameterEstimates(
    fit_crude_Lactobacillus_Y1_bayley_Y2_partial,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                              # none
fit_crude_Lactobacillus_Y1_bayley_Y2_none <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_none,
      ordered = c("g__Lactobacillus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Lactobacillus_Y1_bayley_Y2_none <-
  parameterEstimates(
    fit_crude_Lactobacillus_Y1_bayley_Y2_none,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

table_fit_crude_Lactobacillus_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Lactobacillus_Y1_bayley_Y1_exclusive =
    nettoyage(fit = table_fit_crude_Lactobacillus_Y1_bayley_Y1_exclusive, name_mediator = "Lactobacillus at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Lactobacillus_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Lactobacillus_Y1_bayley_Y2_exclusive, name_mediator = "Lactobacillus at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Lactobacillus_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Lactobacillus_Y1_bayley_Y1_partial, name_mediator = "Lactobacillus at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Lactobacillus_Y1_bayley_Y2_partial =
    nettoyage(fit = table_fit_crude_Lactobacillus_Y1_bayley_Y2_partial, name_mediator = "Lactobacillus at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Lactobacillus_Y1_bayley_Y1_none =
    nettoyage(fit = table_fit_crude_Lactobacillus_Y1_bayley_Y1_none, name_mediator = "Lactobacillus at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Lactobacillus_Y1_bayley_Y2_none =
    nettoyage(fit = table_fit_crude_Lactobacillus_Y1_bayley_Y2_none, name_mediator = "Lactobacillus at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

## sIgA 3M --> Enterococcus Y1 cat --> Bayley
```{r}
model_crude_Y1 <- '# simple mediation
g__Enterococcus_Y1_cat ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_12 ~ b*g__Enterococcus_Y1_cat + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

model_crude_Y2 <- '# simple mediation
g__Enterococcus_Y1_cat ~ a*sIgA_3m_cat_CutOff5
BAYLEYQ4_3_24 ~ b*g__Enterococcus_Y1_cat + c*sIgA_3m_cat_CutOff5
# indirect effect
ab := a*b
# total effect
total := c + (a*b)'

# Crude model, Bayley 1Y
set.seed(1000)                         # exlusive
fit_crude_Enterococcus_Y1_bayley_Y1_exclusive <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_exclusive,
      ordered = c("g__Enterococcus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_Y1_bayley_Y1_exclusive <-
  parameterEstimates(
    fit_crude_Enterococcus_Y1_bayley_Y1_exclusive,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                            # partial
fit_crude_Enterococcus_Y1_bayley_Y1_partial <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_partial,
      ordered = c("g__Enterococcus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_Y1_bayley_Y1_partial <-
  parameterEstimates(
    fit_crude_Enterococcus_Y1_bayley_Y1_partial,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                          # none
fit_crude_Enterococcus_Y1_bayley_Y1_none <-
  sem(model_crude_Y1,
      data = bdd_final_Y1_none,
      ordered = c("g__Enterococcus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_Y1_bayley_Y1_none <-
  parameterEstimates(
    fit_crude_Enterococcus_Y1_bayley_Y1_none,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

# Crude model, Bayley 2Y
set.seed(1000)                                  # exlusive
fit_crude_Enterococcus_Y1_bayley_Y2_exclusive <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_exclusive,
      ordered = c("g__Enterococcus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_Y1_bayley_Y2_exclusive <-
  parameterEstimates(
    fit_crude_Enterococcus_Y1_bayley_Y2_exclusive,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                                  # partial
fit_crude_Enterococcus_Y1_bayley_Y2_partial <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_partial,
      ordered = c("g__Enterococcus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_Y1_bayley_Y2_partial <-
  parameterEstimates(
    fit_crude_Enterococcus_Y1_bayley_Y2_partial,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

set.seed(1000)                              # none
fit_crude_Enterococcus_Y1_bayley_Y2_none <-
  sem(model_crude_Y2,
      data = bdd_final_Y2_none,
      ordered = c("g__Enterococcus_Y1_cat", "sIgA_3m_cat_CutOff5"),
      se = "bootstrap",
      bootstrap = 5000,
      estimator = "DWLS")
table_fit_crude_Enterococcus_Y1_bayley_Y2_none <-
  parameterEstimates(
    fit_crude_Enterococcus_Y1_bayley_Y2_none,
    ci = TRUE,
    level = 0.95,
    boot.ci.type = "perc")

table_fit_crude_Enterococcus_Y1_bayley_Y1_strat  <- list(
  table_fit_crude_Enterococcus_Y1_bayley_Y1_exclusive =
    nettoyage(fit = table_fit_crude_Enterococcus_Y1_bayley_Y1_exclusive, name_mediator = "Enterococcus at 12 months") %>%
    rename("Est Y1 exclusive" = est, "CI Y1 exclusive" = CI, "p-value Y1 exclusive" = pvalue),
  
  table_fit_crude_Enterococcus_Y1_bayley_Y2_exclusive =
    nettoyage(fit = table_fit_crude_Enterococcus_Y1_bayley_Y2_exclusive, name_mediator = "Enterococcus at 12 months") %>%
    rename("Est Y2 exclusive" = est, "CI Y2 exclusive" = CI, "p-value Y2 exclusive" = pvalue),
  
  table_fit_crude_Enterococcus_Y1_bayley_Y1_partial =
    nettoyage(fit = table_fit_crude_Enterococcus_Y1_bayley_Y1_partial, name_mediator = "Enterococcus at 12 months") %>%
    rename("Est Y1 partial" = est, "CI Y1 partial" = CI, "p-value Y1 partial" = pvalue),
  
  table_fit_crude_Enterococcus_Y1_bayley_Y2_partial =
    nettoyage(fit = table_fit_crude_Enterococcus_Y1_bayley_Y2_partial, name_mediator = "Enterococcus at 12 months") %>%
    rename("Est Y2 partial" = est, "CI Y2 partial" = CI, "p-value Y2 partial" = pvalue),
  
  table_fit_crude_Enterococcus_Y1_bayley_Y1_none =
    nettoyage(fit = table_fit_crude_Enterococcus_Y1_bayley_Y1_none, name_mediator = "Enterococcus at 12 months") %>%
    rename("Est Y1 none" = est, "CI Y1 none" = CI, "p-value Y1 none" = pvalue),
  
  table_fit_crude_Enterococcus_Y1_bayley_Y2_none =
    nettoyage(fit = table_fit_crude_Enterococcus_Y1_bayley_Y2_none, name_mediator = "Enterococcus at 12 months") %>%
    rename("Est Y2 none" = est, "CI Y2 none" = CI, "p-value Y2 none" = pvalue)) %>%
  reduce(~left_join(.x, .y, by = c("Predictor", "Mediator", "Path")))
```

```{r}
rm(mediation, nettoyage)
```


# Ancien sens sIgA --> GM 3M --> neuro
```{r}
table_2_ancien_sens <- list(
  table_article_Clusters_Hein_3M = table_article_Clusters_Hein_3M,
  table_article_Proteobacteria_3M = table_article_Proteobacteria_3M,
  table_article_Firmicutes_3M = table_article_Firmicutes_3M,
  table_article_Bacteroidetes_3M = table_article_Bacteroidetes_3M,
  table_article_Actinobacteria_3M = table_article_Actinobacteria_3M,
  table_article_Enterobacteriaceae_g__3M = table_article_Enterobacteriaceae_g__3M,
  table_article_Bacteroides_3M = table_article_Bacteroides_3M,
  table_article_Bifidobacterium_3M = table_article_Bifidobacterium_3M,
  table_article_Veillonella_3M = table_article_Veillonella_3M,
  table_article_Streptococcus_3M = table_article_Streptococcus_3M,
  table_article_Lactobacillus_3M = table_article_Lactobacillus_3M,
  table_article_Enterococcus_3M = table_article_Enterococcus_3M,
  table_article_Cdiff_num_3M = table_article_Cdiff_num_3M,
  table_article_Cdiff_cat_3M = table_article_Cdiff_cat_3M,
  table_article_Acetate_3M = table_article_Acetate_3M,
  table_article_Propionate_3M = table_article_Propionate_3M,
  table_article_Butyrate_3M = table_article_Butyrate_3M,
  table_article_Tryptophan_3M = table_article_Tryptophan_3M,
  table_article_Taurine_3M = table_article_Taurine_3M,
  table_article_Lactate_3M = table_article_Lactate_3M,
  table_article_Formate_3M = table_article_Formate_3M
)


rm(
  table_article_Clusters_Hein_3M, 
  table_article_Proteobacteria_3M, 
  table_article_Firmicutes_3M, 
  table_article_Bacteroidetes_3M, 
  table_article_Actinobacteria_3M, 
  table_article_Enterobacteriaceae_g__3M, 
  table_article_Bacteroides_3M, 
  table_article_Bifidobacterium_3M, 
  table_article_Veillonella_3M, 
  table_article_Streptococcus_3M, 
  table_article_Lactobacillus_3M, 
  table_article_Enterococcus_3M, 
  table_article_Cdiff_num_3M, 
  table_article_Cdiff_cat_3M, 
  table_article_Acetate_3M, 
  table_article_Propionate_3M, 
  table_article_Butyrate_3M, 
  table_article_Tryptophan_3M, 
  table_article_Taurine_3M, 
  table_article_Lactate_3M, 
  table_article_Formate_3M
)

table_2_ancien_sens_strat <- list(
  table_fit_crude_Clusters_Hein_3M_bayley_Y1_strat = table_fit_crude_Clusters_Hein_3M_bayley_Y1_strat,
  table_fit_crude_Proteobacteria_3M_bayley_Y1_strat = table_fit_crude_Proteobacteria_3M_bayley_Y1_strat,
  table_fit_crude_Firmicutes_3M_bayley_Y1_strat = table_fit_crude_Firmicutes_3M_bayley_Y1_strat,
  table_fit_crude_Bacteroidetes_3M_bayley_Y1_strat = table_fit_crude_Bacteroidetes_3M_bayley_Y1_strat,
  table_fit_crude_Actinobacteria_3M_bayley_Y1_strat = table_fit_crude_Actinobacteria_3M_bayley_Y1_strat,
  table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_strat = table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_strat,
  table_fit_crude_Bacteroides_3M_bayley_Y1_strat = table_fit_crude_Bacteroides_3M_bayley_Y1_strat,
  table_fit_crude_Bifidobacterium_3M_bayley_Y1_strat = table_fit_crude_Bifidobacterium_3M_bayley_Y1_strat,
  table_fit_crude_Veillonella_3M_bayley_Y1_strat = table_fit_crude_Veillonella_3M_bayley_Y1_strat,
  table_fit_crude_Streptococcus_3M_bayley_Y1_strat = table_fit_crude_Streptococcus_3M_bayley_Y1_strat,
  table_fit_crude_Lactobacillus_3M_bayley_Y1_strat = table_fit_crude_Lactobacillus_3M_bayley_Y1_strat,
  table_fit_crude_Enterococcus_3M_bayley_Y1_strat = table_fit_crude_Enterococcus_3M_bayley_Y1_strat,
  table_fit_crude_Cdiff_num_3M_bayley_Y1_strat = table_fit_crude_Cdiff_num_3M_bayley_Y1_strat,
  table_fit_crude_Cdiff_cat_3M_bayley_Y1_strat = table_fit_crude_Cdiff_cat_3M_bayley_Y1_strat,
  table_fit_crude_metabolite_Acetate_bayley_Y1_strat = table_fit_crude_metabolite_Acetate_bayley_Y1_strat,
  table_fit_crude_metabolite_Propionate_bayley_Y1_strat = table_fit_crude_metabolite_Propionate_bayley_Y1_strat,
  table_fit_crude_metabolite_Butyrate_bayley_Y1_strat = table_fit_crude_metabolite_Butyrate_bayley_Y1_strat,
  table_fit_crude_metabolite_Tryptophan_bayley_Y1_strat = table_fit_crude_metabolite_Tryptophan_bayley_Y1_strat,
  table_fit_crude_metabolite_Taurine_bayley_Y1_strat = table_fit_crude_metabolite_Taurine_bayley_Y1_strat,
  table_fit_crude_metabolite_Lactate_bayley_Y1_strat = table_fit_crude_metabolite_Lactate_bayley_Y1_strat,
  table_fit_crude_metabolite_Formate_bayley_Y1_strat = table_fit_crude_metabolite_Formate_bayley_Y1_strat
)

rm(
  table_fit_crude_Clusters_Hein_3M_bayley_Y1_strat, 
  table_fit_crude_Proteobacteria_3M_bayley_Y1_strat, 
  table_fit_crude_Firmicutes_3M_bayley_Y1_strat, 
  table_fit_crude_Bacteroidetes_3M_bayley_Y1_strat, 
  table_fit_crude_Actinobacteria_3M_bayley_Y1_strat, 
  table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_strat, 
  table_fit_crude_Bacteroides_3M_bayley_Y1_strat, 
  table_fit_crude_Bifidobacterium_3M_bayley_Y1_strat, 
  table_fit_crude_Veillonella_3M_bayley_Y1_strat, 
  table_fit_crude_Streptococcus_3M_bayley_Y1_strat, 
  table_fit_crude_Lactobacillus_3M_bayley_Y1_strat, 
  table_fit_crude_Enterococcus_3M_bayley_Y1_strat, 
  table_fit_crude_Cdiff_num_3M_bayley_Y1_strat,
  table_fit_crude_Cdiff_cat_3M_bayley_Y1_strat, 
  table_fit_crude_metabolite_Acetate_bayley_Y1_strat, 
  table_fit_crude_metabolite_Propionate_bayley_Y1_strat, 
  table_fit_crude_metabolite_Butyrate_bayley_Y1_strat, 
  table_fit_crude_metabolite_Tryptophan_bayley_Y1_strat, 
  table_fit_crude_metabolite_Taurine_bayley_Y1_strat, 
  table_fit_crude_metabolite_Lactate_bayley_Y1_strat, 
  table_fit_crude_metabolite_Formate_bayley_Y1_strat)
```


# Assemblage et export
## table 2 
```{r}
table_2_boots  <- bind_rows(
  
  table_article_Clusters_Hein_3M_bis,
  table_article_Proteobacteria_3M_bis, 
  table_article_Firmicutes_3M_bis, 
  table_article_Bacteroidetes_3M_bis, 
  table_article_Actinobacteria_3M_bis, 
  
  table_article_Enterobacteriaceae_g__3M_bis,
  table_article_Bacteroides_3M_bis, 
  table_article_Bifidobacterium_3M_bis, 
  table_article_Veillonella_3M_bis,
  
  table_article_Streptococcus_3M_bis, 
  table_article_Lactobacillus_3M_bis, 
  table_article_Enterococcus_3M_bis, 
  
  table_article_Cdiff_num_3M_bis, 
  table_article_Cdiff_cat_3M_bis, 
  
  table_article_Acetate_3M_bis, 
  table_article_Propionate_3M_bis, 
  table_article_Butyrate_3M_bis, 
  
  table_article_Tryptophan_3M_bis, 
  table_article_Taurine_3M_bis, 
  table_article_Lactate_3M_bis, 
  table_article_Formate_3M_bis, 
  
  table_article_Tyrosine_3M_bis, 
  table_article_Valerate_3M_bis
  ) %>%
  
  mutate(
    figures_Y1 = paste(`Est Y1`, " (", `CI Y1`, ") p=", `p-value Y1`, sep = ""), 
    figures_Y2 = paste(`Est Y2`, " (", `CI Y2`, ") p=", `p-value Y2`, sep = ""), 
    `CI Y1` = ifelse(`CI Y1` == "NA, NA", "", `CI Y1`), 
    `CI Y2` = ifelse(`CI Y2` == "NA, NA", "", `CI Y2`), 
    figures_Y1 = ifelse(figures_Y1 == "NA (NA, NA) p=NA", "", figures_Y1), 
    figures_Y2 = ifelse(figures_Y2 == "NA (NA, NA) p=NA", "", figures_Y2)) 


table_2_boots_list <- list(
  table_article_Clusters_Hein_3M_bis = table_article_Clusters_Hein_3M_bis,
  table_article_Proteobacteria_3M_bis = table_article_Proteobacteria_3M_bis,
  table_article_Firmicutes_3M_bis = table_article_Firmicutes_3M_bis,
  table_article_Bacteroidetes_3M_bis = table_article_Bacteroidetes_3M_bis,
  table_article_Actinobacteria_3M_bis = table_article_Actinobacteria_3M_bis,
  
  table_article_Enterobacteriaceae_g__3M_bis = table_article_Enterobacteriaceae_g__3M_bis,
  table_article_Bacteroides_3M_bis = table_article_Bacteroides_3M_bis,
  table_article_Bifidobacterium_3M_bis = table_article_Bifidobacterium_3M_bis,
  table_article_Veillonella_3M_bis = table_article_Veillonella_3M_bis,
  
  table_article_Streptococcus_3M_bis = table_article_Streptococcus_3M_bis,
  table_article_Lactobacillus_3M_bis = table_article_Lactobacillus_3M_bis,
  table_article_Enterococcus_3M_bis = table_article_Enterococcus_3M_bis,
  
  table_article_Cdiff_num_3M_bis = table_article_Cdiff_num_3M_bis,
  table_article_Cdiff_cat_3M_bis = table_article_Cdiff_cat_3M_bis,
  
  table_article_Acetate_3M_bis = table_article_Acetate_3M_bis,
  table_article_Propionate_3M_bis = table_article_Propionate_3M_bis,
  table_article_Butyrate_3M_bis = table_article_Butyrate_3M_bis,
  
  table_article_Tryptophan_3M_bis = table_article_Tryptophan_3M_bis,
  table_article_Taurine_3M_bis = table_article_Taurine_3M_bis,
  table_article_Lactate_3M_bis = table_article_Lactate_3M_bis,
  table_article_Formate_3M_bis = table_article_Formate_3M_bis,
  
  table_article_Tyrosine_3M_bis = table_article_Tyrosine_3M_bis,
  table_article_Valerate_3M_bis = table_article_Valerate_3M_bis
)

rm(table_article_Clusters_Hein_3M_bis,
  table_article_Proteobacteria_3M_bis, 
  table_article_Firmicutes_3M_bis, 
  table_article_Bacteroidetes_3M_bis, 
  table_article_Actinobacteria_3M_bis, 
  
  table_article_Enterobacteriaceae_g__3M_bis,
  table_article_Bacteroides_3M_bis, 
  table_article_Bifidobacterium_3M_bis, 
  table_article_Veillonella_3M_bis,
  
  table_article_Streptococcus_3M_bis, 
  table_article_Lactobacillus_3M_bis, 
  table_article_Enterococcus_3M_bis, 
  
  table_article_Cdiff_num_3M_bis, 
  table_article_Cdiff_cat_3M_bis, 
  
  table_article_Acetate_3M_bis, 
  table_article_Propionate_3M_bis, 
  table_article_Butyrate_3M_bis, 
  
  table_article_Tryptophan_3M_bis, 
  table_article_Taurine_3M_bis, 
  table_article_Lactate_3M_bis, 
  table_article_Formate_3M_bis, 
  
  table_article_Tyrosine_3M_bis, 
  table_article_Valerate_3M_bis)
```

## table 3 
```{r}
table_3_boots  <- bind_rows(
  
  table_article_Clusters_Y1,
  table_article_Proteobacteria_Y1, 
  table_article_Firmicutes_Y1, 
  table_article_Bacteroidetes_Y1, 
  table_article_Actinobacteria_Y1, 
  table_article_Cdiff_num_Y1, 
  table_article_Cdiff_cat_Y1, 
  
  table_article_Bacteroides_Y1,
  table_article_Lachnospiraceae_g_Y1, 
  table_article_Bifidobacterium_Y1, 
  table_article_Veillonella_Y1, 
  table_article_Faecalibacterium_Y1, 
  
  table_article_Streptococcus_Y1, 
  table_article_Lactobacillus_Y1, 
  table_article_Enterococcus_Y1) %>%
  
  mutate(
    figures_Y1 = paste(`Est Y1`, " (", `CI Y1`, ") p=", `p-value Y1`, sep = ""), 
    figures_Y2 = paste(`Est Y2`, " (", `CI Y2`, ") p=", `p-value Y2`, sep = ""), 
    `CI Y1` = ifelse(`CI Y1` == "NA, NA", "", `CI Y1`), 
    `CI Y2` = ifelse(`CI Y2` == "NA, NA", "", `CI Y2`), 
    figures_Y1 = ifelse(figures_Y1 == "NA (NA, NA) p=NA", "", figures_Y1), 
    figures_Y2 = ifelse(figures_Y2 == "NA (NA, NA) p=NA", "", figures_Y2)) 

table_3_boots_list <- list(
  table_article_Clusters_Y1 = table_article_Clusters_Y1,
  table_article_Proteobacteria_Y1 = table_article_Proteobacteria_Y1,
  table_article_Firmicutes_Y1 = table_article_Firmicutes_Y1,
  table_article_Bacteroidetes_Y1 = table_article_Bacteroidetes_Y1,
  table_article_Actinobacteria_Y1 = table_article_Actinobacteria_Y1,
  table_article_Cdiff_num_Y1 = table_article_Cdiff_num_Y1,
  table_article_Cdiff_cat_Y1 = table_article_Cdiff_cat_Y1,
  
  table_article_Bacteroides_Y1 = table_article_Bacteroides_Y1,
  table_article_Lachnospiraceae_g_Y1 = table_article_Lachnospiraceae_g_Y1,
  table_article_Bifidobacterium_Y1 = table_article_Bifidobacterium_Y1,
  table_article_Veillonella_Y1 = table_article_Veillonella_Y1,
  table_article_Faecalibacterium_Y1 = table_article_Faecalibacterium_Y1,
  
  table_article_Streptococcus_Y1 = table_article_Streptococcus_Y1,
  table_article_Lactobacillus_Y1 = table_article_Lactobacillus_Y1,
  table_article_Enterococcus_Y1 = table_article_Enterococcus_Y1
)

rm(table_article_Clusters_Y1,
  table_article_Proteobacteria_Y1, 
  table_article_Firmicutes_Y1, 
  table_article_Bacteroidetes_Y1, 
  table_article_Actinobacteria_Y1, 
  table_article_Cdiff_num_Y1, 
  table_article_Cdiff_cat_Y1, 
  
  table_article_Bacteroides_Y1,
  table_article_Lachnospiraceae_g_Y1, 
  table_article_Bifidobacterium_Y1, 
  table_article_Veillonella_Y1, 
  table_article_Faecalibacterium_Y1, 
  
  table_article_Streptococcus_Y1, 
  table_article_Lactobacillus_Y1, 
  table_article_Enterococcus_Y1)
```

## table S2-S3 
```{r}
table_S2_S3_boots <- bind_rows(
  table_fit_crude_Clusters_Hein_3M_bayley_Y1_strat_bis,
  table_fit_crude_Proteobacteria_3M_bayley_Y1_strat_bis,
  table_fit_crude_Firmicutes_3M_bayley_Y1_strat_bis,
  table_fit_crude_Bacteroidetes_3M_bayley_Y1_strat_bis,
  table_fit_crude_Actinobacteria_3M_bayley_Y1_strat_bis,
  table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_strat_bis,
  table_fit_crude_Bacteroides_3M_bayley_Y1_strat_bis,
  table_fit_crude_Bifidobacterium_3M_bayley_Y1_strat_bis,
  table_fit_crude_Veillonella_3M_bayley_Y1_strat_bis,
  table_fit_crude_Streptococcus_3M_bayley_Y1_strat_bis,
  table_fit_crude_Lactobacillus_3M_bayley_Y1_strat_bis, 
  table_fit_crude_Enterococcus_3M_bayley_Y1_strat_bis, 
  table_fit_crude_Cdiff_num_3M_bayley_Y1_strat_bis, 
  table_fit_crude_Cdiff_cat_3M_bayley_Y1_strat_bis) %>%
  
  mutate(
    figures_Y1_exclusive = paste(`Est Y1 exclusive`, " (", `CI Y1 exclusive`, ") p=", `p-value Y1 exclusive`, sep = ""), 
    figures_Y2_exclusive = paste(`Est Y2 exclusive`, " (", `CI Y2 exclusive`, ") p=", `p-value Y2 exclusive`, sep = ""), 
    
    figures_Y1_partial = paste(`Est Y1 partial`, " (", `CI Y1 partial`, ") p=", `p-value Y1 partial`, sep = ""), 
    figures_Y2_partial = paste(`Est Y2 partial`, " (", `CI Y2 partial`, ") p=", `p-value Y2 partial`, sep = ""), 
    
    figures_Y1_none = paste(`Est Y1 none`, " (", `CI Y1 none`, ") p=", `p-value Y1 none`, sep = ""), 
    figures_Y2_none = paste(`Est Y2 none`, " (", `CI Y2 none`, ") p=", `p-value Y2 none`, sep = "")) %>%
  
  mutate(
    `CI Y1 exclusive` = ifelse(`CI Y1 exclusive` == "NA, NA", "", `CI Y1 exclusive`), 
    `CI Y1 partial` = ifelse(`CI Y1 partial` == "NA, NA", "", `CI Y1 partial`), 
    `CI Y1 none` = ifelse(`CI Y1 none` == "NA, NA", "", `CI Y1 none`), 
    `CI Y2 exclusive` = ifelse(`CI Y2 exclusive` == "NA, NA", "", `CI Y2 exclusive`), 
    `CI Y2 partial` = ifelse(`CI Y2 partial` == "NA, NA", "", `CI Y2 partial`), 
    `CI Y2 none` = ifelse(`CI Y2 none` == "NA, NA", "", `CI Y2 none`), 
    
    figures_Y1_exclusive = ifelse(figures_Y1_exclusive == "NA (NA, NA) p=NA", "", figures_Y1_exclusive), 
    figures_Y1_partial = ifelse(figures_Y1_partial == "NA (NA, NA) p=NA", "", figures_Y1_partial), 
    figures_Y1_none = ifelse(figures_Y1_none == "NA (NA, NA) p=NA", "", figures_Y1_none),
    figures_Y2_exclusive = ifelse(figures_Y2_exclusive == "NA (NA, NA) p=NA", "", figures_Y2_exclusive), 
    figures_Y2_partial = ifelse(figures_Y2_partial == "NA (NA, NA) p=NA", "", figures_Y2_partial), 
    figures_Y2_none = ifelse(figures_Y2_none == "NA (NA, NA) p=NA", "", figures_Y2_none)) %>%
  
  select(Predictor, Mediator, Path, 
         
         `Est Y1 exclusive`, `CI Y1 exclusive`, `p-value Y1 exclusive`,
         `Est Y1 partial`, `CI Y1 partial`, `p-value Y1 partial`,
         `Est Y1 none`, `CI Y1 none`, `p-value Y1 none`,
         
         `Est Y2 exclusive`, `CI Y2 exclusive`, `p-value Y2 exclusive`,
         `Est Y2 partial`, `CI Y2 partial`, `p-value Y2 partial`,
         `Est Y2 none`, `CI Y2 none`, `p-value Y2 none`, 
         
         figures_Y1_exclusive, figures_Y1_partial, figures_Y1_none, 
         figures_Y2_exclusive, figures_Y2_partial, figures_Y2_none) 


table_S2_S3_boots_list <- list(
  table_fit_crude_Clusters_Hein_3M_bayley_Y1_strat_bis = table_fit_crude_Clusters_Hein_3M_bayley_Y1_strat_bis,
  table_fit_crude_Proteobacteria_3M_bayley_Y1_strat_bis = table_fit_crude_Proteobacteria_3M_bayley_Y1_strat_bis,
  table_fit_crude_Firmicutes_3M_bayley_Y1_strat_bis = table_fit_crude_Firmicutes_3M_bayley_Y1_strat_bis,
  table_fit_crude_Bacteroidetes_3M_bayley_Y1_strat_bis = table_fit_crude_Bacteroidetes_3M_bayley_Y1_strat_bis,
  table_fit_crude_Actinobacteria_3M_bayley_Y1_strat_bis = table_fit_crude_Actinobacteria_3M_bayley_Y1_strat_bis,
  table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_strat_bis = table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_strat_bis,
  table_fit_crude_Bacteroides_3M_bayley_Y1_strat_bis = table_fit_crude_Bacteroides_3M_bayley_Y1_strat_bis,
  table_fit_crude_Bifidobacterium_3M_bayley_Y1_strat_bis = table_fit_crude_Bifidobacterium_3M_bayley_Y1_strat_bis,
  table_fit_crude_Veillonella_3M_bayley_Y1_strat_bis = table_fit_crude_Veillonella_3M_bayley_Y1_strat_bis,
  table_fit_crude_Streptococcus_3M_bayley_Y1_strat_bis = table_fit_crude_Streptococcus_3M_bayley_Y1_strat_bis,
  table_fit_crude_Lactobacillus_3M_bayley_Y1_strat_bis = table_fit_crude_Lactobacillus_3M_bayley_Y1_strat_bis,
  table_fit_crude_Enterococcus_3M_bayley_Y1_strat_bis = table_fit_crude_Enterococcus_3M_bayley_Y1_strat_bis,
  table_fit_crude_Cdiff_num_3M_bayley_Y1_strat_bis = table_fit_crude_Cdiff_num_3M_bayley_Y1_strat_bis,
  table_fit_crude_Cdiff_cat_3M_bayley_Y1_strat_bis = table_fit_crude_Cdiff_cat_3M_bayley_Y1_strat_bis
)


rm(table_fit_crude_Clusters_Hein_3M_bayley_Y1_strat_bis,
  table_fit_crude_Proteobacteria_3M_bayley_Y1_strat_bis,
  table_fit_crude_Firmicutes_3M_bayley_Y1_strat_bis,
  table_fit_crude_Bacteroidetes_3M_bayley_Y1_strat_bis,
  table_fit_crude_Actinobacteria_3M_bayley_Y1_strat_bis,
  table_fit_crude_Enterobacteriaceae_g__3M_bayley_Y1_strat_bis,
  table_fit_crude_Bacteroides_3M_bayley_Y1_strat_bis,
  table_fit_crude_Bifidobacterium_3M_bayley_Y1_strat_bis,
  table_fit_crude_Veillonella_3M_bayley_Y1_strat_bis,
  table_fit_crude_Streptococcus_3M_bayley_Y1_strat_bis,
  table_fit_crude_Lactobacillus_3M_bayley_Y1_strat_bis, 
  table_fit_crude_Enterococcus_3M_bayley_Y1_strat_bis, 
  table_fit_crude_Cdiff_num_3M_bayley_Y1_strat_bis, 
  table_fit_crude_Cdiff_cat_3M_bayley_Y1_strat_bis)


table_S2_S3_boots_list_metabolites <- list(
  table_fit_crude_metabolite_Acetate_bayley_Y1_strat_bis = table_fit_crude_metabolite_Acetate_bayley_Y1_strat_bis,
  table_fit_crude_metabolite_Butyrate_bayley_Y1_strat_bis = table_fit_crude_metabolite_Butyrate_bayley_Y1_strat_bis,
  table_fit_crude_metabolite_Formate_bayley_Y1_strat_bis = table_fit_crude_metabolite_Formate_bayley_Y1_strat_bis,
  table_fit_crude_metabolite_Lactate_bayley_Y1_strat_bis = table_fit_crude_metabolite_Lactate_bayley_Y1_strat_bis,
  table_fit_crude_metabolite_Propionate_bayley_Y1_strat_bis = table_fit_crude_metabolite_Propionate_bayley_Y1_strat_bis,
  table_fit_crude_metabolite_Taurine_bayley_Y1_strat_bis = table_fit_crude_metabolite_Taurine_bayley_Y1_strat_bis,
  table_fit_crude_metabolite_Tryptophan_bayley_Y1_strat_bis = table_fit_crude_metabolite_Tryptophan_bayley_Y1_strat_bis,
  table_fit_crude_metabolite_Tyrosine_bayley_Y1_strat_bis = table_fit_crude_metabolite_Tyrosine_bayley_Y1_strat_bis,
  table_fit_crude_metabolite_Valerate_bayley_Y1_strat_bis = table_fit_crude_metabolite_Valerate_bayley_Y1_strat_bis
)


rm(
  table_fit_crude_metabolite_Acetate_bayley_Y1_strat_bis,
  table_fit_crude_metabolite_Butyrate_bayley_Y1_strat_bis, 
  table_fit_crude_metabolite_Formate_bayley_Y1_strat_bis, 
  table_fit_crude_metabolite_Lactate_bayley_Y1_strat_bis, 
  table_fit_crude_metabolite_Propionate_bayley_Y1_strat_bis, 
  table_fit_crude_metabolite_Taurine_bayley_Y1_strat_bis, 
  table_fit_crude_metabolite_Tryptophan_bayley_Y1_strat_bis, 
  table_fit_crude_metabolite_Tyrosine_bayley_Y1_strat_bis, 
  table_fit_crude_metabolite_Valerate_bayley_Y1_strat_bis
)

table_S2_S3_boots_list <- c(table_S2_S3_boots_list, table_S2_S3_boots_list_metabolites)
rm(table_S2_S3_boots_list_metabolites)
```

## table S4-S5 
```{r}
table_S4_S5_boots  <- bind_rows(
  
  table_fit_crude_Clusters_Y1_bayley_Y1_strat,
  table_fit_crude_Proteobacteria_Y1_bayley_Y1_strat, 
  table_fit_crude_Firmicutes_Y1_bayley_Y1_strat, 
  table_fit_crude_Bacteroidetes_Y1_bayley_Y1_strat, 
  table_fit_crude_Actinobacteria_Y1_bayley_Y1_strat, 
  table_fit_crude_Cdiff_num_Y1_bayley_Y1_strat, 
  table_fit_crude_Cdiff_cat_Y1_bayley_Y1_strat, 
  
  table_fit_crude_Bacteroides_Y1_bayley_Y1_strat,
  table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_strat, 
  table_fit_crude_Bifidobacterium_Y1_bayley_Y1_strat, 
  table_fit_crude_Veillonella_Y1_bayley_Y1_strat, 
  table_fit_crude_Faecalibacterium_Y1_bayley_Y1_strat, 
  
  table_fit_crude_Streptococcus_Y1_bayley_Y1_strat, 
  table_fit_crude_Lactobacillus_Y1_bayley_Y1_strat, 
  table_fit_crude_Enterococcus_Y1_bayley_Y1_strat) %>%
  
  mutate(
    figures_Y1_exclusive = paste(`Est Y1 exclusive`, " (", `CI Y1 exclusive`, ") p=", `p-value Y1 exclusive`, sep = ""), 
    figures_Y2_exclusive = paste(`Est Y2 exclusive`, " (", `CI Y2 exclusive`, ") p=", `p-value Y2 exclusive`, sep = ""), 
    
    figures_Y1_partial = paste(`Est Y1 partial`, " (", `CI Y1 partial`, ") p=", `p-value Y1 partial`, sep = ""), 
    figures_Y2_partial = paste(`Est Y2 partial`, " (", `CI Y2 partial`, ") p=", `p-value Y2 partial`, sep = ""), 
    
    figures_Y1_none = paste(`Est Y1 none`, " (", `CI Y1 none`, ") p=", `p-value Y1 none`, sep = ""), 
    figures_Y2_none = paste(`Est Y2 none`, " (", `CI Y2 none`, ") p=", `p-value Y2 none`, sep = "")) %>%
  
  mutate(
    `CI Y1 exclusive` = ifelse(`CI Y1 exclusive` == "NA, NA", "", `CI Y1 exclusive`), 
    `CI Y1 partial` = ifelse(`CI Y1 partial` == "NA, NA", "", `CI Y1 partial`), 
    `CI Y1 none` = ifelse(`CI Y1 none` == "NA, NA", "", `CI Y1 none`), 
    `CI Y2 exclusive` = ifelse(`CI Y2 exclusive` == "NA, NA", "", `CI Y2 exclusive`), 
    `CI Y2 partial` = ifelse(`CI Y2 partial` == "NA, NA", "", `CI Y2 partial`), 
    `CI Y2 none` = ifelse(`CI Y2 none` == "NA, NA", "", `CI Y2 none`), 
    
    figures_Y1_exclusive = ifelse(figures_Y1_exclusive == "NA (NA, NA) p=NA", "", figures_Y1_exclusive), 
    figures_Y1_partial = ifelse(figures_Y1_partial == "NA (NA, NA) p=NA", "", figures_Y1_partial), 
    figures_Y1_none = ifelse(figures_Y1_none == "NA (NA, NA) p=NA", "", figures_Y1_none),
    figures_Y2_exclusive = ifelse(figures_Y2_exclusive == "NA (NA, NA) p=NA", "", figures_Y2_exclusive), 
    figures_Y2_partial = ifelse(figures_Y2_partial == "NA (NA, NA) p=NA", "", figures_Y2_partial), 
    figures_Y2_none = ifelse(figures_Y2_none == "NA (NA, NA) p=NA", "", figures_Y2_none))  %>%
  
    select(Predictor, Mediator, Path, 
         
         `Est Y1 exclusive`, `CI Y1 exclusive`, `p-value Y1 exclusive`,
         `Est Y1 partial`, `CI Y1 partial`, `p-value Y1 partial`,
         `Est Y1 none`, `CI Y1 none`, `p-value Y1 none`,
         
         `Est Y2 exclusive`, `CI Y2 exclusive`, `p-value Y2 exclusive`,
         `Est Y2 partial`, `CI Y2 partial`, `p-value Y2 partial`,
         `Est Y2 none`, `CI Y2 none`, `p-value Y2 none`, 
         
         figures_Y1_exclusive, figures_Y1_partial, figures_Y1_none, 
         figures_Y2_exclusive, figures_Y2_partial, figures_Y2_none)


table_S4_S5_boots_list <- list(
  table_fit_crude_Clusters_Y1_bayley_Y1_strat = table_fit_crude_Clusters_Y1_bayley_Y1_strat,
  table_fit_crude_Proteobacteria_Y1_bayley_Y1_strat = table_fit_crude_Proteobacteria_Y1_bayley_Y1_strat,
  table_fit_crude_Firmicutes_Y1_bayley_Y1_strat = table_fit_crude_Firmicutes_Y1_bayley_Y1_strat,
  table_fit_crude_Bacteroidetes_Y1_bayley_Y1_strat = table_fit_crude_Bacteroidetes_Y1_bayley_Y1_strat,
  table_fit_crude_Actinobacteria_Y1_bayley_Y1_strat = table_fit_crude_Actinobacteria_Y1_bayley_Y1_strat,
  table_fit_crude_Cdiff_num_Y1_bayley_Y1_strat = table_fit_crude_Cdiff_num_Y1_bayley_Y1_strat,
  table_fit_crude_Cdiff_cat_Y1_bayley_Y1_strat = table_fit_crude_Cdiff_cat_Y1_bayley_Y1_strat,
  
  table_fit_crude_Bacteroides_Y1_bayley_Y1_strat = table_fit_crude_Bacteroides_Y1_bayley_Y1_strat,
  table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_strat = table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_strat,
  table_fit_crude_Bifidobacterium_Y1_bayley_Y1_strat = table_fit_crude_Bifidobacterium_Y1_bayley_Y1_strat,
  table_fit_crude_Veillonella_Y1_bayley_Y1_strat = table_fit_crude_Veillonella_Y1_bayley_Y1_strat,
  table_fit_crude_Faecalibacterium_Y1_bayley_Y1_strat = table_fit_crude_Faecalibacterium_Y1_bayley_Y1_strat,
  
  table_fit_crude_Streptococcus_Y1_bayley_Y1_strat = table_fit_crude_Streptococcus_Y1_bayley_Y1_strat,
  table_fit_crude_Lactobacillus_Y1_bayley_Y1_strat = table_fit_crude_Lactobacillus_Y1_bayley_Y1_strat,
  table_fit_crude_Enterococcus_Y1_bayley_Y1_strat = table_fit_crude_Enterococcus_Y1_bayley_Y1_strat
)


rm(
  table_fit_crude_Clusters_Y1_bayley_Y1_strat,
  table_fit_crude_Proteobacteria_Y1_bayley_Y1_strat, 
  table_fit_crude_Firmicutes_Y1_bayley_Y1_strat, 
  table_fit_crude_Bacteroidetes_Y1_bayley_Y1_strat, 
  table_fit_crude_Actinobacteria_Y1_bayley_Y1_strat, 
  table_fit_crude_Cdiff_num_Y1_bayley_Y1_strat, 
  table_fit_crude_Cdiff_cat_Y1_bayley_Y1_strat, 
  
  table_fit_crude_Bacteroides_Y1_bayley_Y1_strat,
  table_fit_crude_Lachnospiraceae_g_Y1_bayley_Y1_strat, 
  table_fit_crude_Bifidobacterium_Y1_bayley_Y1_strat, 
  table_fit_crude_Veillonella_Y1_bayley_Y1_strat, 
  table_fit_crude_Faecalibacterium_Y1_bayley_Y1_strat, 
  
  table_fit_crude_Streptococcus_Y1_bayley_Y1_strat, 
  table_fit_crude_Lactobacillus_Y1_bayley_Y1_strat, 
  table_fit_crude_Enterococcus_Y1_bayley_Y1_strat)
```


# Export
```{r}
save(list = ls(),
     file = "C:/Users/Aline/OneDrive - etu.univ-grenoble-alpes.fr/Documents/5. R projects/symbiota_lab/final_results.RData")
```
